<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>snomtools.data.datasets &mdash; snomtools 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="top" title="snomtools 0.0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">snomtools 0.0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for snomtools.data.datasets</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This file contains the base class for datasets.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;hartelt&#39;</span>

<span class="kn">import</span> <span class="nn">snomtools.calcs.units</span> <span class="kn">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">h5tools</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">termcolor</span> <span class="kn">import</span> <span class="n">colored</span><span class="p">,</span> <span class="n">cprint</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">six</span> <span class="kn">import</span> <span class="n">string_types</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage</span>


<div class="viewcode-block" id="Data_Handler_H5"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5">[docs]</a><span class="k">class</span> <span class="nc">Data_Handler_H5</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	A Data Handler, emulating a Quantity.</span>
<span class="sd">	This &quot;H5 mode&quot; handler keeps the data in h5py objects, but provides access to data as if it were a quantity.</span>
<span class="sd">	&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Data_Handler_H5.__new__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.__new__">[docs]</a>	<span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
				<span class="n">chunks</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s">&quot;gzip&quot;</span><span class="p">,</span> <span class="n">compression_opts</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">chunk_cache_mem_size</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Initializes and returns a new instance. __new__ is used instead of __init__ because pint Quantity does so,</span>
<span class="sd">		and the method is overwritten.</span>

<span class="sd">		:param data: The data to store.</span>

<span class="sd">		:param unit: A valid units string for the unit to convert the data to if necessary.</span>

<span class="sd">		:param shape: If no data is given, data of given shape are initialized with zeroes.</span>

<span class="sd">		:param h5target: If None or True, temporary file mode is enabled, Data is kept on temp</span>
<span class="sd">			files, which are cleaned up in __del__.</span>
<span class="sd">		:type h5target: h5py Group/File</span>

<span class="sd">		:param chunks: (See h5py docs. Chunks are good in most big data cases!)</span>

<span class="sd">		:param compression: (See h5py docs. Compression is good in most cases!)</span>

<span class="sd">		:param compression_opts: (See h5py docs. Compression is good in most cases!)</span>

<span class="sd">		:param chunk_cache_mem_size: Set custom chunk cache memory size for temp files. Default is set in h5tools.</span>

<span class="sd">		:return: The initialized instance.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c"># TODO: Handle Datatypes. Sort compression opts for initializing from existing h5 data.</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">chunks</span><span class="p">:</span>
			<span class="n">compression</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="n">compression_opts</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="k">if</span> <span class="n">h5target</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">h5target</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
			<span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s">&quot;snomtools_H5_tempspace-&quot;</span><span class="p">)</span>
			<span class="c"># temp_dir = os.getcwd() # upper line can be replaced by this for debugging.</span>
			<span class="n">temp_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s">&quot;snomtools_H5_tempspace.hdf5&quot;</span><span class="p">)</span>
			<span class="n">temp_file</span> <span class="o">=</span> <span class="n">h5tools</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">temp_file_path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="n">chunk_cache_mem_size</span><span class="o">=</span><span class="n">chunk_cache_mem_size</span><span class="p">)</span>
			<span class="n">h5target</span> <span class="o">=</span> <span class="n">temp_file</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">temp_file</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="n">temp_dir</span> <span class="o">=</span> <span class="bp">None</span>

		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">chunks</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
				<span class="c"># To improve performance. If the data has a specific chunk size, take that instead of</span>
				<span class="c"># letting h5py guess it.</span>
				<span class="n">chunks</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">chunks</span>
				<span class="k">if</span> <span class="n">compression</span> <span class="o">==</span> <span class="s">&#39;gzip&#39;</span> <span class="ow">and</span> <span class="n">compression_opts</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
					<span class="c"># Also, if compression is default, rather use data options.</span>
					<span class="n">compression</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">compression</span>
					<span class="n">compression_opts</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">compression_opts</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">unit</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">units</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
			<span class="n">inst</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">__used</span> <span class="o">=</span> <span class="bp">False</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">__handling</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">compression</span> <span class="o">=</span> <span class="n">compression</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">compression_opts</span> <span class="o">=</span> <span class="n">compression_opts</span>
			<span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">h5target</span> <span class="ow">is</span> <span class="n">h5target</span><span class="p">:</span>
				<span class="c"># Data already there.</span>
				<span class="k">pass</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c"># We got h5 already, so copying on h5 level is faster because of compression.</span>
				<span class="n">h5tools</span><span class="o">.</span><span class="n">clear_name</span><span class="p">(</span><span class="n">h5target</span><span class="p">,</span> <span class="s">&quot;data&quot;</span><span class="p">)</span>
				<span class="n">data</span><span class="o">.</span><span class="n">h5target</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="n">h5target</span><span class="p">)</span>
				<span class="n">h5tools</span><span class="o">.</span><span class="n">clear_name</span><span class="p">(</span><span class="n">h5target</span><span class="p">,</span> <span class="s">&quot;unit&quot;</span><span class="p">)</span>
				<span class="n">data</span><span class="o">.</span><span class="n">h5target</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s">&quot;unit&quot;</span><span class="p">,</span> <span class="n">h5target</span><span class="p">)</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">ds_data</span> <span class="o">=</span> <span class="n">h5target</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">]</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">ds_unit</span> <span class="o">=</span> <span class="n">h5target</span><span class="p">[</span><span class="s">&quot;unit&quot;</span><span class="p">]</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">h5target</span> <span class="o">=</span> <span class="n">h5target</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">temp_file</span> <span class="o">=</span> <span class="n">temp_file</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">temp_dir</span> <span class="o">=</span> <span class="n">temp_dir</span>
			<span class="k">return</span> <span class="n">inst</span>
		<span class="k">elif</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">inst</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">__used</span> <span class="o">=</span> <span class="bp">False</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">__handling</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">compression</span> <span class="o">=</span> <span class="n">compression</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">compression_opts</span> <span class="o">=</span> <span class="n">compression_opts</span>
			<span class="n">compiled_data</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">compiled_data</span><span class="p">,</span> <span class="s">&#39;shape&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">compiled_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
				<span class="c"># Scalar data. No chunking or compression supported.</span>
				<span class="n">chunks</span> <span class="o">=</span> <span class="bp">False</span>
				<span class="n">compression</span> <span class="o">=</span> <span class="bp">None</span>
				<span class="n">compression_opts</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="n">h5tools</span><span class="o">.</span><span class="n">clear_name</span><span class="p">(</span><span class="n">h5target</span><span class="p">,</span> <span class="s">&quot;data&quot;</span><span class="p">)</span>
			<span class="n">h5tools</span><span class="o">.</span><span class="n">clear_name</span><span class="p">(</span><span class="n">h5target</span><span class="p">,</span> <span class="s">&quot;unit&quot;</span><span class="p">)</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">ds_data</span> <span class="o">=</span> <span class="n">h5target</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">compiled_data</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
												   <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
												   <span class="n">compression_opts</span><span class="o">=</span><span class="n">compression_opts</span><span class="p">)</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">ds_unit</span> <span class="o">=</span> <span class="n">h5target</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&quot;unit&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">compiled_data</span><span class="o">.</span><span class="n">units</span><span class="p">))</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">h5target</span> <span class="o">=</span> <span class="n">h5target</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">temp_file</span> <span class="o">=</span> <span class="n">temp_file</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">temp_dir</span> <span class="o">=</span> <span class="n">temp_dir</span>
			<span class="k">return</span> <span class="n">inst</span>
		<span class="k">elif</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">inst</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">__used</span> <span class="o">=</span> <span class="bp">False</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">__handling</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">compression</span> <span class="o">=</span> <span class="n">compression</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">compression_opts</span> <span class="o">=</span> <span class="n">compression_opts</span>
			<span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>  <span class="c"># Scalar data. No chunking or compression supported.</span>
				<span class="n">chunks</span> <span class="o">=</span> <span class="bp">False</span>
				<span class="n">compression</span> <span class="o">=</span> <span class="bp">None</span>
				<span class="n">compression_opts</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="n">h5tools</span><span class="o">.</span><span class="n">clear_name</span><span class="p">(</span><span class="n">h5target</span><span class="p">,</span> <span class="s">&quot;data&quot;</span><span class="p">)</span>
			<span class="n">h5tools</span><span class="o">.</span><span class="n">clear_name</span><span class="p">(</span><span class="n">h5target</span><span class="p">,</span> <span class="s">&quot;unit&quot;</span><span class="p">)</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">ds_data</span> <span class="o">=</span> <span class="n">h5target</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
												   <span class="n">compression_opts</span><span class="o">=</span><span class="n">compression_opts</span><span class="p">)</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">ds_unit</span> <span class="o">=</span> <span class="n">h5target</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&quot;unit&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">normalize_unitstr</span><span class="p">(</span><span class="n">unit</span><span class="p">))</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">h5target</span> <span class="o">=</span> <span class="n">h5target</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">temp_file</span> <span class="o">=</span> <span class="n">temp_file</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">temp_dir</span> <span class="o">=</span> <span class="n">temp_dir</span>
			<span class="k">return</span> <span class="n">inst</span>
		<span class="k">elif</span> <span class="ow">not</span> <span class="n">temp_file</span><span class="p">:</span>
			<span class="n">inst</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">__used</span> <span class="o">=</span> <span class="bp">False</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">__handling</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">ds_data</span> <span class="o">=</span> <span class="n">h5target</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">]</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">ds_unit</span> <span class="o">=</span> <span class="n">h5target</span><span class="p">[</span><span class="s">&quot;unit&quot;</span><span class="p">]</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">h5target</span> <span class="o">=</span> <span class="n">h5target</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">temp_file</span> <span class="o">=</span> <span class="n">temp_file</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">temp_dir</span> <span class="o">=</span> <span class="n">temp_dir</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">compression</span> <span class="o">=</span> <span class="n">compression</span>
			<span class="n">inst</span><span class="o">.</span><span class="n">compression_opts</span> <span class="o">=</span> <span class="n">compression_opts</span>
			<span class="k">return</span> <span class="n">inst</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Initialized Data_Handler_np with wrong parameters.&quot;</span><span class="p">)</span>

	<span class="c"># TODO: overwrite __getattr__ to avoid invoking _magnitude for performance reasons (all data loaded to RAM).</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5._get__magnitude"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5._get__magnitude">[docs]</a>	<span class="k">def</span> <span class="nf">_get__magnitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>  <span class="c"># array-like</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="p">[:]</span>
		<span class="k">else</span><span class="p">:</span>  <span class="c"># scalar</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="p">[()]</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5._set__magnitude"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5._set__magnitude">[docs]</a>	<span class="k">def</span> <span class="nf">_set__magnitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>  <span class="c"># Same shape, so just overwrite everything in place.</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>  <span class="c"># array-like</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">val</span>
			<span class="k">else</span><span class="p">:</span>  <span class="c"># scalar</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="p">[()]</span> <span class="o">=</span> <span class="n">val</span>
		<span class="k">else</span><span class="p">:</span>  <span class="c"># Different shape, so generate new h5 dataset.</span>
			<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">]</span>
			<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s">&#39;__len__&#39;</span><span class="p">):</span>  <span class="c"># Sequence... so non-scalar data.</span>
				<span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunks</span>
				<span class="n">compression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression</span>
				<span class="n">compression_opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compression_opts</span>
			<span class="k">else</span><span class="p">:</span>  <span class="c"># Scalar data. No chunking or compression supported.</span>
				<span class="n">chunks</span> <span class="o">=</span> <span class="bp">False</span>
				<span class="n">compression</span> <span class="o">=</span> <span class="bp">None</span>
				<span class="n">compression_opts</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">val</span><span class="p">,</span>
														<span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
														<span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
														<span class="n">compression_opts</span><span class="o">=</span><span class="n">compression_opts</span><span class="p">)</span>
</div>
	<span class="n">_magnitude</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get__magnitude</span><span class="p">,</span> <span class="n">_set__magnitude</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;The _magnitude property for Quantity emulation.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Data_Handler_H5._get__units"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5._get__units">[docs]</a>	<span class="k">def</span> <span class="nf">_get__units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">unit_from_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_unit</span><span class="p">[()])</span><span class="o">.</span><span class="n">_units</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5._set__units"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5._set__units">[docs]</a>	<span class="k">def</span> <span class="nf">_set__units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ds_unit</span><span class="p">[()]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
</div>
	<span class="n">_units</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get__units</span><span class="p">,</span> <span class="n">_set__units</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;The _units property for Quantity emulation.&quot;</span><span class="p">)</span>

	<span class="nd">@property</span>
<div class="viewcode-block" id="Data_Handler_H5.dimensionality"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.dimensionality">[docs]</a>	<span class="k">def</span> <span class="nf">dimensionality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">dimensionality</span>
</div>
	<span class="nd">@property</span>
<div class="viewcode-block" id="Data_Handler_H5.q"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.q">[docs]</a>	<span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		The corresponding quantity.</span>

<span class="sd">		:return: The data, converted to a quantity.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
</div>
	<span class="nd">@property</span>
<div class="viewcode-block" id="Data_Handler_H5.temp_file_path"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.temp_file_path">[docs]</a>	<span class="k">def</span> <span class="nf">temp_file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_file</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_file</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>
</div>
	<span class="nd">@property</span>
<div class="viewcode-block" id="Data_Handler_H5.shape"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.shape">[docs]</a>	<span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="o">.</span><span class="n">shape</span>
</div>
	<span class="nd">@property</span>
<div class="viewcode-block" id="Data_Handler_H5.dtype"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.dtype">[docs]</a>	<span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="o">.</span><span class="n">dtype</span>
</div>
	<span class="nd">@property</span>
<div class="viewcode-block" id="Data_Handler_H5.chunks"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.chunks">[docs]</a>	<span class="k">def</span> <span class="nf">chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="o">.</span><span class="n">chunks</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.__getitem__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.__getitem__">[docs]</a>	<span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.__setitem__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.__setitem__">[docs]</a>	<span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		This method provides write access to indexed elements of the data. It directly writes to the h5 dataset</span>
<span class="sd">		without invoking _magnitude, thereby it avoids loading all data into ram.</span>

<span class="sd">		:param key: Index or slice (numpy style as usual) of data to address.</span>

<span class="sd">		:param value: Data to write in addressed elements. Input units will be converted</span>
<span class="sd">			to Data_Handler units (error if not possible). Numeric data (non-Quantities) are assumed as dimensionless (</span>
<span class="sd">			pint-style).</span>

<span class="sd">		.. warning::</span>
<span class="sd">			Value must fit into RAM. Setting bigger-than-RAM slices at a time is not supported (yet).</span>

<span class="sd">		:return: Nothing.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c"># The following line could be replaced with</span>
		<span class="c"># value = u.to_ureg(value).to(self.units)</span>
		<span class="c"># without changing any functionality. But calling to_ureg twice is more efficient because unneccesary calling</span>
		<span class="c">#  of value.to(self.units), which always generates a copy is avoided if possible.</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">magnitude</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.flush"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.flush">[docs]</a>	<span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Flushes the HDF5 buffer to disk. This always concerns the whole H5 file, so the Data_Handler resides on a</span>
<span class="sd">		subgroup, all other datasets on that file are also flushed.</span>
<span class="sd">		:return: nothing</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.get_unit"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.get_unit">[docs]</a>	<span class="k">def</span> <span class="nf">get_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.set_unit"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.set_unit">[docs]</a>	<span class="k">def</span> <span class="nf">set_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unitstr</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Set the unit of the Quantity as specified.</span>

<span class="sd">		:param unitstr: A valid unit string.</span>

<span class="sd">		:return: Nothing.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ito</span><span class="p">(</span><span class="n">unitstr</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.to"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.to">[docs]</a>	<span class="k">def</span> <span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="o">*</span><span class="n">contexts</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx_kwargs</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		A more performant version of pints Quantity&#39;s to, that avoids unneccesary calling of magnitude, and copies on</span>
<span class="sd">		HDF5 level if possible.</span>

<span class="sd">		:param unit: A valid unit string or</span>

<span class="sd">		:param contexts: See pint._Quantity.to().</span>

<span class="sd">		:param ctx_kwargs: See pint._Quantity.to().</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">units</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_H5</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="o">*</span><span class="n">contexts</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx_kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.ito"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.ito">[docs]</a>	<span class="k">def</span> <span class="nf">ito</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="o">*</span><span class="n">contexts</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx_kwargs</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		A more performant version of pints Quantity&#39;s ito, that avoids unneccesary calling of magnitude.</span>

<span class="sd">		:param unit: A valid unit string or</span>

<span class="sd">		:param contexts: See pint._Quantity.to().</span>

<span class="sd">		:param ctx_kwargs: See pint._Quantity.to().</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">same_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="p">)):</span>  <span class="c"># Nothing to do.</span>
			<span class="k">pass</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_H5</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">ito</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="o">*</span><span class="n">contexts</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx_kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.get_nearest_index"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.get_nearest_index">[docs]</a>	<span class="k">def</span> <span class="nf">get_nearest_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the index of the value in the DataArray nearest to a given value.</span>

<span class="sd">		:param value: A value to look for in the array.</span>

<span class="sd">		:return: The index tuple of the array entry nearest to the given value.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c"># TODO: Adapt and optimize memory performance.</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unit</span><span class="p">())</span>
		<span class="n">idx_flat</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span> <span class="o">-</span> <span class="n">value</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
		<span class="n">idx_tup</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">idx_flat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">idx_tup</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.get_nearest_value"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.get_nearest_value">[docs]</a>	<span class="k">def</span> <span class="nf">get_nearest_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Like get_nearest_index, but return the value instead of the index.</span>

<span class="sd">		:param value: value: A value to look for in the array.</span>

<span class="sd">		:return: The value in the array nearest to the given one.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_nearest_index</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.sum_raw"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.sum_raw">[docs]</a>	<span class="k">def</span> <span class="nf">sum_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		As sum(), only on bare numpy array instead of Quantity. See sum() for details.</span>
<span class="sd">		:return: ndarray</span>
<span class="sd">		An array with the same shape as a, with the specified axes removed. If a is a 0-d array, or if axis is None, a</span>
<span class="sd">		scalar is returned. If an output array is specified, a reference to out is returned.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.sum"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.sum">[docs]</a>	<span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Behaves as the sum() function of a numpy array.</span>
<span class="sd">		See: http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.sum.html</span>

<span class="sd">		:param axis: None or int or tuple of ints, optional</span>
<span class="sd">			Axis or axes along which a sum is performed. The default (axis = None) is perform a sum over all the dimensions</span>
<span class="sd">			of the input array. axis may be negative, in which case it counts from the last to the first axis.</span>
<span class="sd">			New in version 1.7.0.:</span>
<span class="sd">			If this is a tuple of ints, a sum is performed on multiple axes, instead of a single axis or all the axes as</span>
<span class="sd">			before.</span>

<span class="sd">		:param dtype: dtype, optional</span>
<span class="sd">			The type of the returned array and of the accumulator in which the elements are summed. By default, the dtype</span>
<span class="sd">			of a is used. An exception is when a has an integer type with less precision than the default platform integer.</span>
<span class="sd">			In that case, the default platform integer is used instead.</span>

<span class="sd">		:param out: ndarray, optional</span>
<span class="sd">			Array into which the output is placed. By default, a new array is created. If out is given, it must be of the</span>
<span class="sd">			appropriate shape (the shape of a with axis removed, i.e., numpy.delete(a.shape, axis)). Its type is preserved.</span>
<span class="sd">			See doc.ufuncs (Section Output arguments) for more details.</span>

<span class="sd">		:param keepdims: bool, optional</span>
<span class="sd">			If this is set to True, the axes which are reduced are left in the result as dimensions with size one. With this</span>
<span class="sd">			option, the result will broadcast correctly against the original arr.</span>

<span class="sd">		:return: ndarray Quantity</span>
<span class="sd">			An array with the same shape as a, with the specified axis removed. If a is a 0-d array, or if axis is None, a</span>
<span class="sd">			scalar is returned. If an output array is specified, a reference to out is returned.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c"># TODO: Handle datatypes.</span>
		<span class="n">inshape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
		<span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">axis</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inshape</span><span class="p">)))</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c"># If we have a sequence of len 1, we sum over only 1 axis.</span>
				<span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
			<span class="c"># axis has no len, so it is propably an integer already. Just go on...</span>
			<span class="k">pass</span>

		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">keepdims</span><span class="p">:</span>
				<span class="n">outshape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inshape</span><span class="p">)</span>
				<span class="n">outshape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
				<span class="n">outshape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">outshape</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">outshape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">inshape</span><span class="p">,</span> <span class="n">axis</span><span class="p">))</span>
			<span class="k">if</span> <span class="n">out</span><span class="p">:</span>
				<span class="k">assert</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">outshape</span><span class="p">,</span> <span class="s">&quot;Wrong shape of given destination.&quot;</span>
				<span class="n">outdata</span> <span class="o">=</span> <span class="n">out</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">outdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">outshape</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unit</span><span class="p">(),</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inshape</span><span class="p">[</span><span class="n">axis</span><span class="p">]):</span>
				<span class="n">slicebase</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">s_</span><span class="p">[:]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inshape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
				<span class="n">slicebase</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">outdata</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>  <span class="c"># Scalar</span>
					<span class="n">outdata</span><span class="o">.</span><span class="n">ds_data</span><span class="p">[()]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">slicebase</span><span class="p">)]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">outdata</span><span class="o">.</span><span class="n">ds_data</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">slicebase</span><span class="p">)]</span>
			<span class="k">return</span> <span class="n">outdata</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">axis</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">axis</span><span class="p">))</span>
			<span class="n">axisnow</span> <span class="o">=</span> <span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">keepdims</span><span class="p">:</span>  <span class="c"># Axes positions stay as they are. Prepare sum tuple for rest of summations.</span>
				<span class="n">axisrest</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
			<span class="k">else</span><span class="p">:</span>  <span class="c"># Sum erases axis number axis[0], rest of axis ids to sum over is shifted by -1</span>
				<span class="n">axisrest</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
			<span class="c"># Perform summation over axisnow and recursively sum over rest:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axisnow</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">keepdims</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axisrest</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">keepdims</span><span class="p">,</span> <span class="n">h5target</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.absmax"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.absmax">[docs]</a>	<span class="k">def</span> <span class="nf">absmax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.absmin"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.absmin">[docs]</a>	<span class="k">def</span> <span class="nf">absmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.shift"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.shift">[docs]</a>	<span class="k">def</span> <span class="nf">shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">prefilter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Shifts the complete data with scipy.ndimage.interpolation.shift.</span>
<span class="sd">		In difference to that method, it does not need an input, but works on the instance data.</span>
<span class="sd">		Also, the defaults are different.</span>

<span class="sd">		.. warning::</span>
<span class="sd">			For shifting, the whole data is loaded into RAM. Sequential shifting might be implemented later.</span>

<span class="sd">		See: :func:`scipy.ndimage.interpolation.shift` for full documentation of parameters.</span>

<span class="sd">		:param output: The array in which to place the output, or the dtype of the returned array.</span>
<span class="sd">			If :code:`False` is given, the instance data is overwritten.</span>
<span class="sd">		:type output: ndarray *or* dtype *or* :code:`False`, *optional*</span>

<span class="sd">		:param h5target: The h5target to in case a new Data_Handler_H5 is generated.</span>

<span class="sd">		:returns: The shifted data. If output is given as a parameter or :code:`False`, None is returned.</span>
<span class="sd">		:rtype: Data_Handler_np *or* None</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">prefilter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># if not explicitly set, determine neccesity of prefiltering</span>
			<span class="k">if</span> <span class="n">order</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># if interpolation is required, spline prefilter is neccesary.</span>
				<span class="n">prefilter</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">prefilter</span> <span class="o">=</span> <span class="bp">False</span>

		<span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_magnitude</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">interpolation</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span>
																<span class="n">prefilter</span><span class="p">)</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
			<span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">interpolation</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="n">prefilter</span><span class="p">)</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="p">(</span><span class="n">output</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">type</span><span class="p">),</span> <span class="s">&quot;Invalid output argument given.&quot;</span>
			<span class="k">return</span> <span class="n">Data_Handler_H5</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">interpolation</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span>
																	 <span class="n">prefilter</span><span class="p">),</span>
								   <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.shift_slice"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.shift_slice">[docs]</a>	<span class="k">def</span> <span class="nf">shift_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slice_</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">prefilter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
					<span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Shifts a certain slice of the data with scipy.ndimage.interpolation.shift.</span>
<span class="sd">		See: :func:`scipy.ndimage.interpolation.shift` for full documentation of parameters.</span>

<span class="sd">		:param slice_: A selection of a subset of the data, typically a tuple of ints or slices. Can be generated</span>
<span class="sd">			easily with	:func:`numpy.s_` or builtin method :func:`slice`.</span>
<span class="sd">		:type slice_: slice **or** tuple(slice) **or** *(tuple of) castable*.</span>

<span class="sd">		:param output: The array in which to place the output, or the dtype of the returned array.</span>
<span class="sd">			If :code:`False` is given, the slice of the instance data is overwritten.</span>
<span class="sd">		:type output: ndarray *or* dtype *or* :code:`False`, *optional*</span>

<span class="sd">		:param h5target: The h5target to in case a new Data_Handler_H5 is generated.</span>

<span class="sd">		:returns: The shifted data. If output is given as a parameter or :code:`False`, None is returned.</span>
<span class="sd">		:rtype: Data_Handler_np *or* None</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">prefilter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># if not explicitly set, determine neccesity of prefiltering</span>
			<span class="k">if</span> <span class="n">order</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># if interpolation is required, spline prefilter is neccesary.</span>
				<span class="n">prefilter</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">prefilter</span> <span class="o">=</span> <span class="bp">False</span>

		<span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="p">[</span><span class="n">slice_</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">interpolation</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="p">[</span><span class="n">slice_</span><span class="p">],</span> <span class="n">shift</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span>
																	 <span class="n">cval</span><span class="p">,</span> <span class="n">prefilter</span><span class="p">)</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
			<span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">interpolation</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="p">[</span><span class="n">slice_</span><span class="p">],</span> <span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="n">prefilter</span><span class="p">)</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="p">(</span><span class="n">output</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">type</span><span class="p">),</span> <span class="s">&quot;Invalid output argument given.&quot;</span>
			<span class="k">return</span> <span class="n">Data_Handler_H5</span><span class="p">(</span>
				<span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">interpolation</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_data</span><span class="p">[</span><span class="n">slice_</span><span class="p">],</span> <span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span>
												  <span class="n">prefilter</span><span class="p">),</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.__add__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.__add__">[docs]</a>	<span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unit</span><span class="p">())</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_H5</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__add__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.__sub__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.__sub__">[docs]</a>	<span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_H5</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__sub__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.__mul__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.__mul__">[docs]</a>	<span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_H5</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__mul__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.__div__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.__div__">[docs]</a>	<span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_H5</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__div__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.__floordiv__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.__floordiv__">[docs]</a>	<span class="k">def</span> <span class="nf">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_H5</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__floordiv__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.__pow__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.__pow__">[docs]</a>	<span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&#39;dimensionless&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_H5</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__pow__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.__array__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.__array__">[docs]</a>	<span class="k">def</span> <span class="nf">__array__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.__repr__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.__repr__">[docs]</a>	<span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="s">&quot;&lt;Data_Handler_H5 on {0} with shape {1}&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_H5.__del__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.__del__">[docs]</a>	<span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_file</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
			<span class="n">file_to_remove</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_file_path</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">temp_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_to_remove</span><span class="p">)</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">)</span>
			<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
				<span class="k">print</span><span class="p">(</span><span class="s">&quot;WARNING: Data_Handler_H5 could not remove tempdir. Propably not empty.&quot;</span><span class="p">)</span>
				<span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</div>
	<span class="nd">@classmethod</span>
<div class="viewcode-block" id="Data_Handler_H5.stack"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_H5.stack">[docs]</a>	<span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">tostack</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Stacks a sequence of given Data_Handlers (or castables) along a new axis.</span>

<span class="sd">		:param tostack: Sequence of Data_Handlers (or castables), each must be of the same shape and unit.</span>

<span class="sd">		:param axis: int, optional: The axis in the result array along which the input arrays are stacked.</span>

<span class="sd">		:param unit: optional: A valid unit string to convert the stack to. Default is the unit of the first element</span>
<span class="sd">			of the sequence.</span>

<span class="sd">		:param h5target: optional: A h5target to work on. See __new__</span>

<span class="sd">		:return: stacked Data_Handler</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">unit</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tostack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
		<span class="n">inshape</span> <span class="o">=</span> <span class="n">tostack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
		<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">tostack</span><span class="p">:</span>
			<span class="k">assert</span> <span class="n">e</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">inshape</span><span class="p">,</span> <span class="s">&quot;Data_Handler_H5.stack got elements of varying shape.&quot;</span>
		<span class="n">shapelist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inshape</span><span class="p">)</span>
		<span class="n">shapelist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tostack</span><span class="p">))</span>
		<span class="n">outshape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shapelist</span><span class="p">)</span>
		<span class="n">inst</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">outshape</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tostack</span><span class="p">)):</span>
			<span class="n">slicebase</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">s_</span><span class="p">[:]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inshape</span><span class="p">))]</span>
			<span class="n">slicebase</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
			<span class="n">inst</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">slicebase</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tostack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">inst</span>

</div></div>
<div class="viewcode-block" id="Data_Handler_np"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np">[docs]</a><span class="k">class</span> <span class="nc">Data_Handler_np</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	A Data Handler, emulating a Quantity.</span>
<span class="sd">	This &quot;numpy mode&quot; handler actually just mainly shadows the attributes of the Quantity that is held and should be</span>
<span class="sd">	use as such a Quantity. Of cause this Quantity itself shadows most of the attributes of the underlying numpy</span>
<span class="sd">	array and can therefore be used as one in many contexts.</span>
<span class="sd">	&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Data_Handler_np.__new__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.__new__">[docs]</a>	<span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">compiled_data</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_np</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">compiled_data</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">compiled_data</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">),</span> <span class="n">unit</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Initialized Data_Handler_np with wrong parameters.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.__setitem__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.__setitem__">[docs]</a>	<span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
			<span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_np</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.get_unit"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.get_unit">[docs]</a>	<span class="k">def</span> <span class="nf">get_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.set_unit"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.set_unit">[docs]</a>	<span class="k">def</span> <span class="nf">set_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unitstr</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Set the unit of the Quantity as specified.</span>

<span class="sd">		:param unitstr: A valid unit string.</span>

<span class="sd">		:return: Nothing.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ito</span><span class="p">(</span><span class="n">unitstr</span><span class="p">)</span>
</div>
	<span class="nd">@property</span>
<div class="viewcode-block" id="Data_Handler_np.q"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.q">[docs]</a>	<span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		The corresponding quantity.</span>

<span class="sd">		:return: The data, converted to a quantity.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.get_nearest_index"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.get_nearest_index">[docs]</a>	<span class="k">def</span> <span class="nf">get_nearest_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the index of the value in the DataArray nearest to a given value.</span>

<span class="sd">		:param value: A value to look for in the array.</span>

<span class="sd">		:return: The index tuple of the array entry nearest to the given value.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unit</span><span class="p">())</span>
		<span class="n">idx_flat</span> <span class="o">=</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span> <span class="o">-</span> <span class="n">value</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
		<span class="n">idx_tup</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">idx_flat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">idx_tup</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.get_nearest_value"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.get_nearest_value">[docs]</a>	<span class="k">def</span> <span class="nf">get_nearest_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Like get_nearest_index, but return the value instead of the index.</span>

<span class="sd">		:param value: value: A value to look for in the array.</span>

<span class="sd">		:return: The value in the array nearest to the given one.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_nearest_index</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.sum_raw"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.sum_raw">[docs]</a>	<span class="k">def</span> <span class="nf">sum_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		As sum(), only on bare numpy array instead of Quantity. See sum() for details.</span>
<span class="sd">		:return: ndarray</span>
<span class="sd">		An array with the same shape as a, with the specified axes removed. If a is a 0-d array, or if axis is None, a</span>
<span class="sd">		scalar is returned. If an output array is specified, a reference to out is returned.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.absmax"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.absmax">[docs]</a>	<span class="k">def</span> <span class="nf">absmax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.absmin"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.absmin">[docs]</a>	<span class="k">def</span> <span class="nf">absmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.shift"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.shift">[docs]</a>	<span class="k">def</span> <span class="nf">shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">prefilter</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Shifts the complete data with scipy.ndimage.interpolation.shift.</span>
<span class="sd">		In difference to that method, it does not need an input, but works on the instance data.</span>
<span class="sd">		Also, the defaults are different.</span>

<span class="sd">		See: :func:`scipy.ndimage.interpolation.shift` for full documentation of parameters.</span>

<span class="sd">		:param output: The array in which to place the output, or the dtype of the returned array.</span>
<span class="sd">			If :code:`False` is given, the instance data is overwritten.</span>
<span class="sd">		:type output: ndarray *or* dtype *or* :code:`False`, *optional*</span>

<span class="sd">		:returns: The shifted data. If output is given as a parameter or :code:`False`, None is returned.</span>
<span class="sd">		:rtype: Data_Handler_np *or* None</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">prefilter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># if not explicitly set, determine neccesity of prefiltering</span>
			<span class="k">if</span> <span class="n">order</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># if interpolation is required, spline prefilter is neccesary.</span>
				<span class="n">prefilter</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">prefilter</span> <span class="o">=</span> <span class="bp">False</span>

		<span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">interpolation</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span>
															   <span class="n">prefilter</span><span class="p">)</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
			<span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">interpolation</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="n">prefilter</span><span class="p">)</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="p">(</span><span class="n">output</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">type</span><span class="p">),</span> <span class="s">&quot;Invalid output argument given.&quot;</span>
			<span class="k">return</span> <span class="n">Data_Handler_np</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">interpolation</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span>
																	 <span class="n">prefilter</span><span class="p">),</span>
								   <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.shift_slice"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.shift_slice">[docs]</a>	<span class="k">def</span> <span class="nf">shift_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slice_</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">prefilter</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Shifts a certain slice of the data with scipy.ndimage.interpolation.shift.</span>
<span class="sd">		See: :func:`scipy.ndimage.interpolation.shift` for full documentation of parameters.</span>

<span class="sd">		:param slice_: A selection of a subset of the data, typically a tuple of ints or slices. Can be generated</span>
<span class="sd">			easily with	:func:`numpy.s_` or builtin method :func:`slice`.</span>
<span class="sd">		:type slice_: slice **or** tuple(slice) **or** *(tuple of) castable*.</span>

<span class="sd">		:param output: The array in which to place the output, or the dtype of the returned array.</span>
<span class="sd">			If :code:`False` is given, the slice of the instance data is overwritten.</span>
<span class="sd">		:type output: ndarray *or* dtype *or* :code:`False`, *optional*</span>

<span class="sd">		:returns: The shifted data. If output is given as a parameter or :code:`False`, None is returned.</span>
<span class="sd">		:rtype: Data_Handler_np *or* None</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">prefilter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># if not explicitly set, determine neccesity of prefiltering</span>
			<span class="k">if</span> <span class="n">order</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># if interpolation is required, spline prefilter is neccesary.</span>
				<span class="n">prefilter</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">prefilter</span> <span class="o">=</span> <span class="bp">False</span>

		<span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="p">[</span><span class="n">slice_</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">interpolation</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="p">[</span><span class="n">slice_</span><span class="p">],</span> <span class="n">shift</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span>
																	   <span class="n">cval</span><span class="p">,</span> <span class="n">prefilter</span><span class="p">)</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
			<span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">interpolation</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="p">[</span><span class="n">slice_</span><span class="p">],</span> <span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="n">prefilter</span><span class="p">)</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="p">(</span><span class="n">output</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">type</span><span class="p">),</span> <span class="s">&quot;Invalid output argument given.&quot;</span>
			<span class="k">return</span> <span class="n">Data_Handler_np</span><span class="p">(</span>
				<span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">interpolation</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="p">[</span><span class="n">slice_</span><span class="p">],</span> <span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span>
												  <span class="n">prefilter</span><span class="p">),</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.__add__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.__add__">[docs]</a>	<span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unit</span><span class="p">())</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_np</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__add__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.__sub__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.__sub__">[docs]</a>	<span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_np</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__sub__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.__mul__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.__mul__">[docs]</a>	<span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_np</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__mul__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.__div__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.__div__">[docs]</a>	<span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_np</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__div__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.__floordiv__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.__floordiv__">[docs]</a>	<span class="k">def</span> <span class="nf">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_np</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__floordiv__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.__pow__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.__pow__">[docs]</a>	<span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&#39;dimensionless&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_np</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__pow__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.__repr__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.__repr__">[docs]</a>	<span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="s">&quot;&lt;Data_Handler_np(&quot;</span> <span class="o">+</span> <span class="nb">super</span><span class="p">(</span><span class="n">Data_Handler_np</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;)&gt;&quot;</span>
</div>
<div class="viewcode-block" id="Data_Handler_np.__del__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.__del__">[docs]</a>	<span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">pass</span>
</div>
	<span class="nd">@classmethod</span>
<div class="viewcode-block" id="Data_Handler_np.stack"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Data_Handler_np.stack">[docs]</a>	<span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">tostack</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Stacks a sequence of given Data_Handlers (or castables) along a new axis.</span>

<span class="sd">		:param tostack: Sequence of Data_Handlers (or castables), each must be of the same shape and dimensionality.</span>

<span class="sd">		:param axis: int, optional: The axis in the result array along which the input arrays are stacked.</span>

<span class="sd">		:param unit: optional: A valid unit string to convert the stack to. Default is the unit of the first element</span>
<span class="sd">			of the sequence.</span>

<span class="sd">		:return: stacked Data_Handler</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">unit</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tostack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">as_ureg_quantities</span><span class="p">(</span><span class="n">tostack</span><span class="p">,</span> <span class="n">unit</span><span class="p">)),</span> <span class="n">axis</span><span class="p">),</span> <span class="n">unit</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="DataArray"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray">[docs]</a><span class="k">class</span> <span class="nc">DataArray</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	A data array that holds additional metadata.</span>
<span class="sd">	&quot;&quot;&quot;</span>

<div class="viewcode-block" id="DataArray.__init__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__init__">[docs]</a>	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
				 <span class="n">chunks</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s">&quot;gzip&quot;</span><span class="p">,</span> <span class="n">compression_opts</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">chunk_cache_mem_size</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Guess what, this is an initializer. It differences between input formats, which should be clear from the</span>
<span class="sd">		parameter doc and the comments in the code.</span>

<span class="sd">		:param data: required. If this is already a DataArray instance, it is just copied by default, so if the</span>
<span class="sd">			other parameters are set, the contents of the instance are overwritten.</span>

<span class="sd">		:param unit: Request a unit for the data to be in. If the data holds a unit (quantity), it must be the same</span>
<span class="sd">			dimensionality. If it doesn&#39;t (array-like), it is assumed to be in the given unit! Default is None for</span>
<span class="sd">			unchanged in the first case and dimensionless in the second.</span>

<span class="sd">		:param label: A short identifier label that should be meaningful to get the physical context of the data.</span>

<span class="sd">		:param plotlabel: A label for the data that should be plotted in a diagram.</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chunks</span> <span class="o">=</span> <span class="n">chunks</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">compression</span> <span class="o">=</span> <span class="n">compression</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">compression_opts</span> <span class="o">=</span> <span class="n">compression_opts</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chunk_cache_mem_size</span> <span class="o">=</span> <span class="n">chunk_cache_mem_size</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5target</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="o">=</span> <span class="n">h5target</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">own_h5file</span> <span class="o">=</span> <span class="bp">False</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5target</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="o">=</span> <span class="n">h5tools</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">h5target</span><span class="p">,</span> <span class="n">chunk_cache_mem_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk_cache_mem_size</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">own_h5file</span> <span class="o">=</span> <span class="bp">True</span>
		<span class="k">elif</span> <span class="n">h5target</span><span class="p">:</span>  <span class="c"># True but no designated target means temp file mode.</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">own_h5file</span> <span class="o">=</span> <span class="bp">False</span>
		<span class="k">else</span><span class="p">:</span>  <span class="c"># Numpy mode.</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">own_h5file</span> <span class="o">=</span> <span class="bp">False</span>

		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">DataArray</span><span class="p">):</span>  <span class="c"># If the data already comes in a DataArray, just take it.</span>
			<span class="k">if</span> <span class="n">chunks</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>  <span class="c"># Instead of defaults, take data options</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">chunks</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">chunks</span>
			<span class="k">if</span> <span class="n">compression</span> <span class="o">==</span> <span class="s">&#39;gzip&#39;</span> <span class="ow">and</span> <span class="n">compression_opts</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c"># Instead of defaults, take data options</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">compression</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">compression</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">compression_opts</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">compression_opts</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">unit</span><span class="p">:</span>  <span class="c"># If a unit is explicitly requested anyway, make sure we set it.</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">set_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">label</span><span class="p">:</span>  <span class="c"># Same with label, else take the one that&#39;s already with the data</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">plotlabel</span><span class="p">:</span>  <span class="c"># Same as with label.</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span> <span class="o">=</span> <span class="n">plotlabel</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get_plotlabel</span><span class="p">()</span>
			<span class="c"># A DataArray contains everything we need, so we should be done here!</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>  <span class="c"># If a HDF5 Group was given, load data directly.</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">load_from_h5</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>  <span class="c"># We DON&#39;T have everything contained in data, so we need to process it seperately.</span>
			<span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># No data. Initialize empty instance.</span>
			<span class="k">elif</span> <span class="n">u</span><span class="o">.</span><span class="n">is_quantity</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>  <span class="c"># Kind of the same as above, just for the data itself.</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
				<span class="k">if</span> <span class="n">unit</span><span class="p">:</span>  <span class="c"># If a unit is explicitly requested anyway, make sure we set it.</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">set_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
			<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>  <span class="c"># If it&#39;s a string, try to evaluate it as an array.</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span> <span class="n">unit</span><span class="p">)</span>
			<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>  <span class="c"># If it is an ndarray, just make a quantity with it.</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>  <span class="c"># If it&#39;s none of the above, it hopefully is an array-like. So let&#39;s try to cast it.</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">unit</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">plotlabel</span><span class="p">)</span>
</div>
	<span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataArray.from_h5"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.from_h5">[docs]</a>	<span class="k">def</span> <span class="nf">from_h5</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">h5source</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		This method initializes a DataArray from a HDF5 source.</span>

<span class="sd">		:param h5source: The HDF5 source to read from. This is generally the subgroup for the DataArray.</span>

<span class="sd">		:param h5target: Optional. The HDF5 target to work on, if on-disk h5 mode is desired.</span>

<span class="sd">		:return: The initialized DataArray.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5source</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">),</span> <span class="s">&quot;DataArray.from_h5 requires h5py group as source.&quot;</span>
		<span class="k">if</span> <span class="n">h5target</span><span class="p">:</span>
			<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5target</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">),</span> <span class="s">&quot;DataArray.from_h5 requires h5py group as target.&quot;</span>
		<span class="n">out</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>
		<span class="n">out</span><span class="o">.</span><span class="n">load_from_h5</span><span class="p">(</span><span class="n">h5source</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">out</span>
</div>
	<span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataArray.in_h5"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.in_h5">[docs]</a>	<span class="k">def</span> <span class="nf">in_h5</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">h5source</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		This method initializes a DataArray from a HDF5 source, which then works on the same H5 File. This is</span>
<span class="sd">		identical to calling DataArray.from_h5(h5source, h5target=h5source), which is actually done here.</span>

<span class="sd">		:param h5source: The HDF5 source to read from. This is generally the subgroup for the DataArray.</span>

<span class="sd">		:return: The initialized DataArray.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">from_h5</span><span class="p">(</span><span class="n">h5source</span><span class="p">,</span> <span class="n">h5source</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.__getattr__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__getattr__">[docs]</a>	<span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		This method provides dynamical naming in instances. It is called any time an attribute of the intstance is</span>
<span class="sd">		not found with the normal naming mechanism. Raises an AttributeError if the name cannot be resolved.</span>

<span class="sd">		:param item: The name to get the corresponding attribute.</span>

<span class="sd">		:return: The attribute corresponding to the given name.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;Attribute </span><span class="se">\&#39;</span><span class="s">{0}</span><span class="se">\&#39;</span><span class="s"> of DataArray instance cannot be resolved.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="DataArray.get_data"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.get_data">[docs]</a>	<span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c"># print &quot;data property getter&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</div>
<div class="viewcode-block" id="DataArray.set_data"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.set_data">[docs]</a>	<span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newdata</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">newdata</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray._set_data"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray._set_data">[docs]</a>	<span class="k">def</span> <span class="nf">_set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
		<span class="c"># print &quot;data property setter&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>  <span class="c"># initialize H5 data in h5target group</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">Data_Handler_H5</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">,</span>
											 <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">,</span> <span class="n">compression_opts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compression_opts</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>  <span class="c"># no group given but h5target==True, so work in h5 tempfile mode.</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">Data_Handler_H5</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">,</span>
											 <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compression</span><span class="p">,</span> <span class="n">compression_opts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compression_opts</span><span class="p">,</span>
											 <span class="n">chunk_cache_mem_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk_cache_mem_size</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">Data_Handler_np</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.del_data"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.del_data">[docs]</a>	<span class="k">def</span> <span class="nf">del_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;WARNING: Trying to delete data from DataArray.&#39;</span><span class="p">)</span>
</div>
	<span class="n">data</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_data</span><span class="p">,</span> <span class="n">_set_data</span><span class="p">,</span> <span class="n">del_data</span><span class="p">,</span> <span class="s">&quot;The data property for the DataArray.&quot;</span><span class="p">)</span>

	<span class="nd">@property</span>
<div class="viewcode-block" id="DataArray.rawdata"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.rawdata">[docs]</a>	<span class="k">def</span> <span class="nf">rawdata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the data as a raw numpy array, not a quantity. Forwards to get_data_raw().</span>

<span class="sd">		:return: ndarray: The data as a numpy array.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_raw</span><span class="p">()</span>
</div>
	<span class="nd">@property</span>
<div class="viewcode-block" id="DataArray.shape"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.shape">[docs]</a>	<span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span>
</div>
	<span class="nd">@property</span>
<div class="viewcode-block" id="DataArray.units"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.units">[docs]</a>	<span class="k">def</span> <span class="nf">units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">units</span>
</div>
<div class="viewcode-block" id="DataArray.get_data_raw"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.get_data_raw">[docs]</a>	<span class="k">def</span> <span class="nf">get_data_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the data as a raw numpy array, not a quantity.</span>

<span class="sd">		:return: ndarray: The data as a numpy array.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">magnitude</span>
</div>
<div class="viewcode-block" id="DataArray.swapaxes"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.swapaxes">[docs]</a>	<span class="k">def</span> <span class="nf">swapaxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis1</span><span class="p">,</span> <span class="n">axis2</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Swaps two axes of the data. Uses numpy.swapaxes.</span>

<span class="sd">		:param axis1: int: First axis.</span>

<span class="sd">		:param axis2: int: Second axis.</span>

<span class="sd">		:return: The data after the transformation.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_raw</span><span class="p">()</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">axis1</span><span class="p">,</span> <span class="n">axis2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unit</span><span class="p">())</span>
		<span class="c"># TODO: This is not feasible for big data in H5 handlers. Look for more efficient implementation.</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</div>
<div class="viewcode-block" id="DataArray.get_unit"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.get_unit">[docs]</a>	<span class="k">def</span> <span class="nf">get_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.set_unit"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.set_unit">[docs]</a>	<span class="k">def</span> <span class="nf">set_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unitstr</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Set the unit of the dataarray as specified.</span>
<span class="sd">		Warning: The plotlabel typically includes a unit, so this might get invalid!</span>

<span class="sd">		:param unitstr: A valid unit string.</span>

<span class="sd">		:return: Nothing.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_unit</span><span class="p">(</span><span class="n">unitstr</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.to"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.to">[docs]</a>	<span class="k">def</span> <span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unitstr</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns a copy of the dataarray with the unit set as specified. For compatibility with pint quantity.</span>
<span class="sd">		Warning: The plotlabel typically includes a unit, so this might get invalid!</span>

<span class="sd">		:param unitstr: A valid unit string.</span>

<span class="sd">		:return: The dataset copy with the specified unit.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">unitstr</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.get_label"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.get_label">[docs]</a>	<span class="k">def</span> <span class="nf">get_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
</div>
<div class="viewcode-block" id="DataArray.set_label"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.set_label">[docs]</a>	<span class="k">def</span> <span class="nf">set_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newlabel</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">newlabel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.get_plotlabel"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.get_plotlabel">[docs]</a>	<span class="k">def</span> <span class="nf">get_plotlabel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span>
</div>
<div class="viewcode-block" id="DataArray.set_plotlabel"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.set_plotlabel">[docs]</a>	<span class="k">def</span> <span class="nf">set_plotlabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newlabel</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">newlabel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.store_to_h5"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.store_to_h5">[docs]</a>	<span class="k">def</span> <span class="nf">store_to_h5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5dest</span><span class="p">,</span> <span class="n">subgrp_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s">&quot;gzip&quot;</span><span class="p">,</span> <span class="n">compression_opts</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Stores the DataArray into a HDF5 file. It will create a new subgroup and store the data there in a unified</span>
<span class="sd">		format.</span>

<span class="sd">		:param h5dest: The destination. This is a HDF5 file or subgroup.</span>

<span class="sd">		:param subgrp_name: Optional. The name for the subgroup that is created to store the data in, Default is the</span>
<span class="sd">			label of the DataArray.</span>

<span class="sd">		:return The subgroup that was created and holds the data.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">subgrp_name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">subgrp_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
		<span class="n">grp</span> <span class="o">=</span> <span class="n">h5dest</span><span class="o">.</span><span class="n">require_group</span><span class="p">(</span><span class="n">subgrp_name</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">write_to_h5</span><span class="p">(</span><span class="n">grp</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span> <span class="n">compression_opts</span><span class="o">=</span><span class="n">compression_opts</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">grp</span>
</div>
<div class="viewcode-block" id="DataArray.write_to_h5"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.write_to_h5">[docs]</a>	<span class="k">def</span> <span class="nf">write_to_h5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5dest</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s">&quot;gzip&quot;</span><span class="p">,</span> <span class="n">compression_opts</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Writes the DataArray into a HDF5 group. It will store the data there in a unified</span>
<span class="sd">		format. It will overwrite any dataset in the given group that is named with any of the unified names.</span>

<span class="sd">		:param h5dest: The destination. This is a HDF5 file or subgroup. Can be None if the DataSet has a h5target (</span>
<span class="sd">			works on a h5 group in file mode), in that case, self.h5target will be taken.</span>

<span class="sd">		:return The h5 group (or file) that holds the written data.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">h5dest</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">:</span>
			<span class="n">h5dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">chunks</span><span class="p">:</span>
			<span class="n">compression</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="n">compression_opts</span> <span class="o">=</span> <span class="bp">None</span>

		<span class="k">if</span> <span class="n">h5dest</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">:</span>
				<span class="c"># We are in h5 mode, so copying on h5 level is faster because of compression.</span>
				<span class="n">h5tools</span><span class="o">.</span><span class="n">clear_name</span><span class="p">(</span><span class="n">h5dest</span><span class="p">,</span> <span class="s">&quot;data&quot;</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">h5target</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ds_data</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">h5dest</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">h5tools</span><span class="o">.</span><span class="n">write_dataset</span><span class="p">(</span><span class="n">h5dest</span><span class="p">,</span> <span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_raw</span><span class="p">(),</span> <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
									  <span class="n">compression_opts</span><span class="o">=</span><span class="n">compression_opts</span><span class="p">)</span>
			<span class="n">h5tools</span><span class="o">.</span><span class="n">write_dataset</span><span class="p">(</span><span class="n">h5dest</span><span class="p">,</span> <span class="s">&quot;unit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unit</span><span class="p">())</span>
		<span class="n">h5tools</span><span class="o">.</span><span class="n">write_dataset</span><span class="p">(</span><span class="n">h5dest</span><span class="p">,</span> <span class="s">&quot;label&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_label</span><span class="p">())</span>
		<span class="n">h5tools</span><span class="o">.</span><span class="n">write_dataset</span><span class="p">(</span><span class="n">h5dest</span><span class="p">,</span> <span class="s">&quot;plotlabel&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_plotlabel</span><span class="p">())</span>
		<span class="k">return</span> <span class="n">h5dest</span>
</div>
<div class="viewcode-block" id="DataArray.load_from_h5"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.load_from_h5">[docs]</a>	<span class="k">def</span> <span class="nf">load_from_h5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5source</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Loads the data from a HDF5 source.</span>

<span class="sd">		:param h5source: The source to read from. This is the subgroup of the DataArray.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="o">==</span> <span class="n">h5source</span><span class="p">:</span>  <span class="c"># We already work on the h5source. Just initialize handler.</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">Data_Handler_H5</span><span class="p">(</span><span class="n">h5target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
			<span class="c"># We work on a h5target, but not h5source. Copy h5source and initialize handler. This should be much more</span>
			<span class="c"># performant than reading data and storing them again, because of compression.</span>
			<span class="k">for</span> <span class="n">h5set</span> <span class="ow">in</span> <span class="n">h5source</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
				<span class="n">h5source</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">h5set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">Data_Handler_H5</span><span class="p">(</span><span class="n">h5target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">h5source</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">]),</span> <span class="n">h5source</span><span class="p">[</span><span class="s">&quot;unit&quot;</span><span class="p">][()])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">h5source</span><span class="p">[</span><span class="s">&quot;label&quot;</span><span class="p">][()])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">set_plotlabel</span><span class="p">(</span><span class="n">h5source</span><span class="p">[</span><span class="s">&quot;plotlabel&quot;</span><span class="p">][()])</span>
</div>
<div class="viewcode-block" id="DataArray.flush"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.flush">[docs]</a>	<span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Flushes HDF5 buffers to disk. This only makes sense in h5 disk mode and in non-tempfile mode.</span>

<span class="sd">		:return: Nothing.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">write_to_h5</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&quot;WARNING: DataSet cannot flush without working on valid HDF5 file.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.get_nearest_index"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.get_nearest_index">[docs]</a>	<span class="k">def</span> <span class="nf">get_nearest_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the index of the value in the DataArray nearest to a given value.</span>

<span class="sd">		:param value: A value to look for in the array.</span>

<span class="sd">		:return: The index tuple of the array entry nearest to the given value.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get_nearest_index</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.get_nearest_value"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.get_nearest_value">[docs]</a>	<span class="k">def</span> <span class="nf">get_nearest_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Like get_nearest_index, but return the value instead of the index.</span>

<span class="sd">		:param value: value: A value to look for in the array.</span>

<span class="sd">		:return: The value in the array nearest to the given one.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get_nearest_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.sum"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.sum">[docs]</a>	<span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Behaves as the sum() function of a numpy array.</span>
<span class="sd">		See: http://docs.scipy.org/doc/numpy-1.10.1/reference/generated/numpy.sum.html</span>

<span class="sd">		:param axis: None or int or tuple of ints, optional</span>
<span class="sd">			Axis or axes along which a sum is performed. The default (axis = None) is perform a sum over all the dimensions</span>
<span class="sd">			of the input array. axis may be negative, in which case it counts from the last to the first axis.</span>
<span class="sd">			New in version 1.7.0.:</span>
<span class="sd">			If this is a tuple of ints, a sum is performed on multiple axes, instead of a single axis or all the axes as</span>
<span class="sd">			before.</span>

<span class="sd">		:param dtype: dtype, optional</span>
<span class="sd">			The type of the returned array and of the accumulator in which the elements are summed. By default, the dtype</span>
<span class="sd">			of a is used. An exception is when a has an integer type with less precision than the default platform integer.</span>
<span class="sd">			In that case, the default platform integer is used instead.</span>

<span class="sd">		:param out: ndarray, optional</span>
<span class="sd">			Array into which the output is placed. By default, a new array is created. If out is given, it must be of the</span>
<span class="sd">			appropriate shape (the shape of a with axis removed, i.e., numpy.delete(a.shape, axis)). Its type is preserved.</span>
<span class="sd">			See doc.ufuncs (Section Output arguments) for more details.</span>

<span class="sd">		:param keepdims: bool, optional</span>
<span class="sd">			If this is set to True, the axes which are reduced are left in the result as dimensions with size one. With this</span>
<span class="sd">			option, the result will broadcast correctly against the original arr.</span>

<span class="sd">		:return: ndarray Quantity</span>
<span class="sd">			An array with the same shape as a, with the specified axis removed. If a is a 0-d array, or if axis is None, a</span>
<span class="sd">			scalar is returned. If an output array is specified, a reference to out is returned.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.sum_raw"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.sum_raw">[docs]</a>	<span class="k">def</span> <span class="nf">sum_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		As sum(), only on bare numpy array instead of Quantity. See sum() for details.</span>
<span class="sd">		:return: ndarray</span>
<span class="sd">		An array with the same shape as a, with the specified axes removed. If a is a 0-d array, or if axis is None, a</span>
<span class="sd">		scalar is returned. If an output array is specified, a reference to out is returned.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sum_raw</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.project_nd"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.project_nd">[docs]</a>	<span class="k">def</span> <span class="nf">project_nd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Projects the datafield onto the given axes. Uses sum() method, but adresses axes to keep instead of axes to</span>
<span class="sd">		sum over.</span>

<span class="sd">		:param args: Integer indices for the axes to project onto.</span>

<span class="sd">		:return: ndarray quantity: The projected data.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">sumlist</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>  <span class="c"># initialize list of axes to sum over</span>
		<span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
			<span class="k">assert</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">),</span> <span class="s">&quot;ERROR: Invalid type. Axis index must be integer.&quot;</span>
			<span class="n">sumlist</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
		<span class="n">sumtup</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sumlist</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sumtup</span><span class="p">):</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sumtup</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="DataArray.shift"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.shift">[docs]</a>	<span class="k">def</span> <span class="nf">shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">prefilter</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Shifts the complete data. This is just calling the underlying methods implemented in</span>
<span class="sd">			:func:`Data_Handler_H5.shift` and :func:`Data_Handler_np.shift`</span>
<span class="sd">			See those methods for documentation or under-the-hood-used :func:`scipy.ndimage.interpolation.shift` for</span>
<span class="sd">			full documentation of parameters.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">cval</span><span class="p">,</span> <span class="n">prefilter</span><span class="o">=</span><span class="n">prefilter</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.shift_slice"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.shift_slice">[docs]</a>	<span class="k">def</span> <span class="nf">shift_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slice_</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">prefilter</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Shifts a certain slice of the data. This is just calling the underlying methods implemented in</span>
<span class="sd">			:func:`Data_Handler_H5.shift_slice` and :func:`Data_Handler_np.shift_slice`</span>
<span class="sd">			See those methods for documentation or under-the-hood-used :func:`scipy.ndimage.interpolation.shift` for</span>
<span class="sd">			full documentation of parameters.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shift_slice</span><span class="p">(</span><span class="n">slice_</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">cval</span><span class="p">,</span>
									 <span class="n">prefilter</span><span class="o">=</span><span class="n">prefilter</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.max"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.max">[docs]</a>	<span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DataArray.min"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.min">[docs]</a>	<span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DataArray.absmax"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.absmax">[docs]</a>	<span class="k">def</span> <span class="nf">absmax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">absmax</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DataArray.absmin"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.absmin">[docs]</a>	<span class="k">def</span> <span class="nf">absmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">absmin</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DataArray.mean"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.mean">[docs]</a>	<span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DataArray.__pos__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__pos__">[docs]</a>	<span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.__neg__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__neg__">[docs]</a>	<span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.__abs__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__abs__">[docs]</a>	<span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.__add__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__add__">[docs]</a>	<span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unit</span><span class="p">())</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">other</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.__sub__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__sub__">[docs]</a>	<span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unit</span><span class="p">())</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">other</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.__mul__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__mul__">[docs]</a>	<span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">other</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.__div__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__div__">[docs]</a>	<span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="n">other</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.__floordiv__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__floordiv__">[docs]</a>	<span class="k">def</span> <span class="nf">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">//</span> <span class="n">other</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.__pow__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__pow__">[docs]</a>	<span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
		<span class="n">other</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&#39;dimensionless&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">**</span> <span class="n">other</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.__array__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__array__">[docs]</a>	<span class="k">def</span> <span class="nf">__array__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c"># to numpy array</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">magnitude</span>
</div>
<div class="viewcode-block" id="DataArray.__iter__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__iter__">[docs]</a>	<span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.__getitem__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__getitem__">[docs]</a>	<span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		To allow adressing parts or elements of the DataArray with [], including slicing as in numpy. This just</span>
<span class="sd">		forwards to the underlying __getitem__ method of the data object.</span>

<span class="sd">		:param key: The key which is given as adressed in dataarray[key]. Can be an integer or a slice object.</span>

<span class="sd">		:return: The sliced data as returned by self.data[key].</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c"># if an int is used as an index in a 1D dataarray, a single element is adressed:</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
		<span class="c"># if tuple of ints with length of the number of dimensions of the data is given, we have a single element again:</span>
		<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
			<span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">))):</span>
				<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">()</span>  <span class="c"># a single element must have shape () because it is 0D</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
		<span class="c"># else a part of the array is adressed (even if all dimensions of len 1, this will still be an dataarray...</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.__setitem__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__setitem__">[docs]</a>	<span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		To allow adressing parts or elements of the DataArray with [], including slicing as in numpy. This just</span>
<span class="sd">		forwards to the underlying __setitem__ method of the data object.</span>

<span class="sd">		:param key: the key in the []</span>

<span class="sd">		:param value: the value to set it to</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="DataArray.__len__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__len__">[docs]</a>	<span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c"># len of data array</span>
		<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataArray.__str__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__str__">[docs]</a>	<span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">out</span> <span class="o">=</span> <span class="s">&quot;DataArray&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
			<span class="n">out</span> <span class="o">+=</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
		<span class="n">out</span> <span class="o">+=</span> <span class="s">&quot; with shape &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
		<span class="c"># out += &#39;\n&#39; + str(self.data)</span>
		<span class="k">return</span> <span class="n">out</span>
</div>
<div class="viewcode-block" id="DataArray.__repr__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__repr__">[docs]</a>	<span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">out</span> <span class="o">=</span> <span class="s">&#39;DataArray(&#39;</span>
		<span class="n">out</span> <span class="o">+=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
		<span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;, &#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
			<span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;label=&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
			<span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;, &#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span><span class="p">:</span>
			<span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;plotlabel=&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span>
			<span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;, &#39;</span>
		<span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>
		<span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;)&#39;</span>
		<span class="k">return</span> <span class="n">out</span>
</div>
<div class="viewcode-block" id="DataArray.__del__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.__del__">[docs]</a>	<span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">own_h5file</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>  <span class="c"># Temp file mode</span>
			<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</div>
	<span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataArray.stack"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataArray.stack">[docs]</a>	<span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">datastack</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Stacks a sequence of DataArrays to a new DataArray.</span>
<span class="sd">		See numpy.stack, as this method is used.</span>

<span class="sd">		:param datastack: sequence of DataArrays: The Data to be stacked.</span>

<span class="sd">		:param axis: int, optional: The axis in the result array along which the input arrays are stacked.</span>

<span class="sd">		:param unit: string, optional: The unit for the stacked DataArray. All data must be convertible to that unit. If</span>
<span class="sd">			not given, the unit of the first DataArray in the input stack is used.</span>

<span class="sd">		:param label: string, optional: The label for the new DataSet. If not given, the label of the first DataArray in</span>
<span class="sd">			the input stack is used.</span>

<span class="sd">		:param plotlabel: string, optional: The plotlabel for the new DataArray. If not given, the label of the first</span>
<span class="sd">			DataArray in the input stack is used.</span>

<span class="sd">		:return: The stacked DataArray.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">for</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">datastack</span><span class="p">:</span>
			<span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">DataArray</span><span class="p">)),</span> <span class="s">&quot;ERROR: Non-DataArray object given to stack_DataArrays&quot;</span>
		<span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">unit</span> <span class="o">=</span> <span class="n">datastack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_unit</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">label</span> <span class="o">=</span> <span class="n">datastack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">plotlabel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">plotlabel</span> <span class="o">=</span> <span class="n">datastack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_plotlabel</span><span class="p">()</span>
		<span class="n">onlydata</span> <span class="o">=</span> <span class="p">[</span><span class="n">da</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span> <span class="k">for</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">datastack</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">h5target</span><span class="p">:</span>
			<span class="n">stacked_data</span> <span class="o">=</span> <span class="n">Data_Handler_H5</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">onlydata</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">stacked_data</span> <span class="o">=</span> <span class="n">Data_Handler_np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">onlydata</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">stacked_data</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="n">plotlabel</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Axis"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Axis">[docs]</a><span class="k">class</span> <span class="nc">Axis</span><span class="p">(</span><span class="n">DataArray</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	An axis is a data array that holds the data for an axis of a dataset.</span>
<span class="sd">	&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Axis.__init__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Axis.__init__">[docs]</a>	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		So far, an Axis is the same as a DaraArray, with the exception that it is one-dimensional. Therefore this</span>
<span class="sd">		method uses the __init__ of the parent class and parameters are exactly as there.</span>

<span class="sd">		:param data:</span>

<span class="sd">		:param unit:</span>

<span class="sd">		:param label:</span>

<span class="sd">		:param plotlabel:</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">DataArray</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="n">plotlabel</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># check if data makes sense if instance is not empty.</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">assure_1D</span><span class="p">()</span>
			<span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="s">&quot;Axis not initialized with 1D array-like object.&quot;</span>
</div>
	<span class="nd">@classmethod</span>
<div class="viewcode-block" id="Axis.from_dataarray"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Axis.from_dataarray">[docs]</a>	<span class="k">def</span> <span class="nf">from_dataarray</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">da</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Initializes an Axis instance from a DataArray instance (which is mostly, but not completely the same).</span>

<span class="sd">		:param da: An instance of the DataArray class.</span>

<span class="sd">		:return: The new initialized instance of Axis.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">da</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="n">da</span><span class="o">.</span><span class="n">plotlabel</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">da</span><span class="o">.</span><span class="n">h5target</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Axis.__getattr__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Axis.__getattr__">[docs]</a>	<span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		This method provides dynamical naming in instances. It is called any time an attribute of the intstance is</span>
<span class="sd">		not found with the normal naming mechanism. Raises an AttributeError if the name cannot be resolved.</span>

<span class="sd">		:param item: The name to get the corresponding attribute.</span>

<span class="sd">		:return: The attribute corresponding to the given name.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;Attribute </span><span class="se">\&#39;</span><span class="s">{0}</span><span class="se">\&#39;</span><span class="s"> of Axis instance cannot be resolved.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Axis.assure_1D"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Axis.assure_1D">[docs]</a>	<span class="k">def</span> <span class="nf">assure_1D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Makes sure the data is onedimensional. Try a consistent conversion, if that fails raise error.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c"># Array itself is 1D</span>
			<span class="k">return</span>
		<span class="c"># Else we have a moredimensional array. Try to flatten it:</span>
		<span class="n">flatarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flatarray</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>  <span class="c"># an invalid conversion.</span>
			<span class="k">raise</span> <span class="ne">ArithmeticError</span><span class="p">(</span><span class="s">&quot;Non-1D convertable data array in Axis.&quot;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">flatarray</span>
</div>
<div class="viewcode-block" id="Axis.get_index_searchsort"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Axis.get_index_searchsort">[docs]</a>	<span class="k">def</span> <span class="nf">get_index_searchsort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Assuming the axis elements are sorted (which should be the case, the way all is implemented atm), for every</span>
<span class="sd">		value given, there is a corresponding index in the array, where the value could be inserted while maintaining</span>
<span class="sd">		order of the array.</span>
<span class="sd">		This function searches these indexes by using the numpy.searchsorted function.</span>

<span class="sd">		:param values: array_like: Values to insert into the axis.</span>

<span class="sd">		:return: array of ints: The corresponding indexes with the same shape as values.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Axis.scale_linear"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Axis.scale_linear">[docs]</a>	<span class="k">def</span> <span class="nf">scale_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Transforms the Axis by scaling it with a linear factor and optionally shifting it by an offset.</span>
<span class="sd">		:param scaling: The scaling factor.</span>
<span class="sd">		:param offset: The offset. Must have the same dimension as the scaled axis.</span>
<span class="sd">		:param unit: Specifies the output unit for the Axis, Must evaluate a unit with same dimension as the scaled axis.</span>
<span class="sd">		:return: The transformed Axis.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">points_scaled</span> <span class="o">=</span> <span class="n">scaling</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
		<span class="k">if</span> <span class="n">offset</span><span class="p">:</span>
			<span class="n">points_scaled</span> <span class="o">=</span> <span class="n">points_scaled</span> <span class="o">+</span> <span class="n">offset</span>
		<span class="k">if</span> <span class="n">unit</span><span class="p">:</span>
			<span class="n">points_scaled</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">points_scaled</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">points_scaled</span>
</div>
<div class="viewcode-block" id="Axis.__str__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Axis.__str__">[docs]</a>	<span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">out</span> <span class="o">=</span> <span class="s">&quot;Axis&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
			<span class="n">out</span> <span class="o">+=</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
		<span class="n">out</span> <span class="o">+=</span> <span class="s">&quot; with shape &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
		<span class="c"># out += &#39;\n&#39; + str(self.data)</span>
		<span class="k">return</span> <span class="n">out</span>
</div>
<div class="viewcode-block" id="Axis.__repr__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.Axis.__repr__">[docs]</a>	<span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">out</span> <span class="o">=</span> <span class="s">&#39;Axis(&#39;</span>
		<span class="n">out</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
		<span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;, &#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
			<span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;label=&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
			<span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;, &#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span><span class="p">:</span>
			<span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;plotlabel=&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span>
			<span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;, &#39;</span>
		<span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>
		<span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;)&#39;</span>
		<span class="k">return</span> <span class="n">out</span>

</div></div>
<div class="viewcode-block" id="ROI"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI">[docs]</a><span class="k">class</span> <span class="nc">ROI</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	A Region of Interest: This is a way to define a (rectangular) mask in the multidimensional DataSet,</span>
<span class="sd">	and then interfacing the generated ROI, as you would the overlying DataSet.</span>
<span class="sd">	Consequently, the ROI shall be implemented to behave as a DataSet.</span>
<span class="sd">	&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ROI.__init__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.__init__">[docs]</a>	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">limitlist</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">by_index</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		The constructor. Translates the given limits to the corresponding array indices and stores them as instance</span>
<span class="sd">		variables. Each set of limits must be given as 2-tuples of the form (start,stop), where start and stop can be a</span>
<span class="sd">		quantity with a value on the axis which will be cast as the next nearest index, a valid axis array index</span>
<span class="sd">		(see by_index), or None for no limitation.</span>

<span class="sd">		:param dataset: The DataSet instance to work on. A ROI only makes sense on a specific dataset...</span>

<span class="sd">		:param limitlist: A list or dict containing the limits for each axis. If a dict is given, the keys must be</span>
<span class="sd">			valid identifiers of an axis of the DataSet (see DataSet.get_axis()). If a list is given, each entry must</span>
<span class="sd">			contain the limit set for one axis in the same order as in the axes list of the DataSet, Limit sets must</span>
<span class="sd">			2-tuples as described above.</span>

<span class="sd">		:param by_index: Bool flag to interpret limits not as positions, but as array indices.</span>

<span class="sd">		:param label: String: A label describing the ROI.</span>

<span class="sd">		:param plotlabel: String: A label describing the ROI for plots.</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plotlabel</span> <span class="o">=</span> <span class="n">plotlabel</span>
		<span class="c"># create empty limit list:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">limits</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">axes</span><span class="p">))]</span>
		<span class="c"># iterate over keys in the limit list if given:</span>
		<span class="k">if</span> <span class="n">limitlist</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">set_limits_all</span><span class="p">(</span><span class="n">limitlist</span><span class="p">,</span> <span class="n">by_index</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ROI.__getattr__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.__getattr__">[docs]</a>	<span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		This method provides dynamical naming in instances. It is called any time an attribute of the intstance is</span>
<span class="sd">		not found with the normal naming mechanism. Raises an AttributeError if the name cannot be resolved.</span>

<span class="sd">		:param item: The name to get the corresponding attribute.</span>

<span class="sd">		:return: The attribute corresponding to the given name.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s">&quot;alldata&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">datafields</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">axes</span>
		<span class="k">elif</span> <span class="n">item</span> <span class="o">==</span> <span class="s">&quot;axlabels&quot;</span><span class="p">:</span>
			<span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
				<span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get_label</span><span class="p">())</span>
			<span class="k">return</span> <span class="n">labels</span>
		<span class="k">elif</span> <span class="n">item</span> <span class="o">==</span> <span class="s">&quot;dlabels&quot;</span><span class="p">:</span>
			<span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">datafields</span><span class="p">:</span>
				<span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get_label</span><span class="p">())</span>
			<span class="k">return</span> <span class="n">labels</span>
		<span class="k">elif</span> <span class="n">item</span> <span class="o">==</span> <span class="s">&quot;labels&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabels</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">axlabels</span>
		<span class="k">elif</span> <span class="n">item</span> <span class="o">==</span> <span class="s">&quot;dimensions&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">item</span> <span class="o">==</span> <span class="s">&quot;shape&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_datafield</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
		<span class="k">elif</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">darray</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alldata</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">darray</span><span class="o">.</span><span class="n">get_label</span><span class="p">():</span>
					<span class="n">lim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
					<span class="k">return</span> <span class="n">darray</span><span class="p">[</span><span class="n">lim</span><span class="p">]</span>
		<span class="c"># TODO: address xyz.</span>
		<span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;Name </span><span class="se">\&#39;</span><span class="s">{0}</span><span class="se">\&#39;</span><span class="s"> in ROI object cannot be resolved!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ROI.set_limits_all"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.set_limits_all">[docs]</a>	<span class="k">def</span> <span class="nf">set_limits_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limitlist</span><span class="p">,</span> <span class="n">by_index</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Each set of limits must be given as 2-tuples of the form (start,stop), where start and stop can be a quantity</span>
<span class="sd">		with a value on the axis which will be cast as the next nearest index, a valid axis array index (see by_index),</span>
<span class="sd">		or None for an unchanged limit.</span>

<span class="sd">		:param limitlist: A list or dict containing the limits for each axis. If a dict is given, the keys must be</span>
<span class="sd">			valid identifiers of an axis of the DataSet (see DataSet.get_axis()). If a list is given, each entry must</span>
<span class="sd">			contain the limit set for one axis in the same order as in the axes list of the DataSet, Limit sets must</span>
<span class="sd">			2-tuples as described above.</span>

<span class="sd">		:param by_index: Bool flag to interpret limits not as positions, but as array indices.</span>

<span class="sd">		:return: Nothing</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">limitlist</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lims</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">limitlist</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">set_limits</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">lims</span><span class="p">,</span> <span class="n">by_index</span><span class="o">=</span><span class="n">by_index</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">limitlist</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">limitlist</span><span class="p">:</span>
				<span class="c"># key is a dict key or the correct index, so get_axis_index works...</span>
				<span class="n">keyindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_axis_index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
				<span class="c"># get the corresponding axis:</span>
				<span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">keyindex</span><span class="p">]</span>
				<span class="c"># get the axis index corresponding to the limit and store it:</span>
				<span class="k">if</span> <span class="n">limitlist</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
					<span class="k">if</span> <span class="n">by_index</span><span class="p">:</span>
						<span class="n">left_limit_index</span> <span class="o">=</span> <span class="n">limitlist</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">left_limit_index</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_nearest_index</span><span class="p">(</span><span class="n">limitlist</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
						<span class="c"># get_nearest_index returns an index tuple, which has only 1 element for the 1D axis.</span>
						<span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">left_limit_index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="s">&quot;Index tuple for axis must have one element!&quot;</span>
						<span class="n">left_limit_index</span> <span class="o">=</span> <span class="n">left_limit_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
					<span class="c"># Try to address the place of the index:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">ax</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="n">left_limit_index</span><span class="p">]</span>
					<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
						<span class="k">print</span><span class="p">(</span><span class="s">&quot;ERROR: ROI index not int as in indexing.&quot;</span><span class="p">)</span>
						<span class="k">raise</span> <span class="n">e</span>
					<span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
						<span class="k">print</span><span class="p">(</span><span class="s">&quot;ERROR: ROI index not valid (typically out of bounds).&quot;</span><span class="p">)</span>
						<span class="k">raise</span> <span class="n">e</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">keyindex</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_limit_index</span>
				<span class="k">if</span> <span class="n">limitlist</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
					<span class="k">if</span> <span class="n">by_index</span><span class="p">:</span>
						<span class="n">right_limit_index</span> <span class="o">=</span> <span class="n">limitlist</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">right_limit_index</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_nearest_index</span><span class="p">(</span><span class="n">limitlist</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
						<span class="c"># get_nearest_index returns an index tuple, which has only 1 element for the 1D axis.</span>
						<span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">right_limit_index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="s">&quot;Index tuple for axis must have one element!&quot;</span>
						<span class="n">right_limit_index</span> <span class="o">=</span> <span class="n">right_limit_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
					<span class="c"># Try to address the place of the index:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">ax</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="n">right_limit_index</span><span class="p">]</span>
					<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
						<span class="k">print</span><span class="p">(</span><span class="s">&quot;ERROR: ROI index not int as in indexing.&quot;</span><span class="p">)</span>
						<span class="k">raise</span> <span class="n">e</span>
					<span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
						<span class="k">print</span><span class="p">(</span><span class="s">&quot;ERROR: ROI index not valid (typically out of bounds).&quot;</span><span class="p">)</span>
						<span class="k">raise</span> <span class="n">e</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">keyindex</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_limit_index</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;ROI set_limits_all input not a list or dict.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ROI.set_limits"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.set_limits">[docs]</a>	<span class="k">def</span> <span class="nf">set_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">by_index</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Sets both limits for one axis:</span>

<span class="sd">		:param key: A valid identifier of an axis of the DataSet (see DataSet.get_axis())</span>

<span class="sd">		:param values: Tuple or list of length 2 with the new values for the limits.</span>

<span class="sd">		:param by_index: Bool flag to interpret limits not as positions, but as array indices.</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">),</span> <span class="s">&quot;Invalid set for values.&quot;</span>
		<span class="n">keyindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_axis_index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">keyindex</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">by_index</span><span class="p">:</span>
			<span class="n">left_limit_index</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">right_limit_index</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">left_limit_index</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_nearest_index</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="c"># get_nearest_index returns an index tuple, which has only 1 element for the 1D axis.</span>
			<span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">left_limit_index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="s">&quot;Index tuple for axis must have one element!&quot;</span>
			<span class="n">left_limit_index</span> <span class="o">=</span> <span class="n">left_limit_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">right_limit_index</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_nearest_index</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
			<span class="c"># get_nearest_index returns an index tuple, which has only 1 element for the 1D axis.</span>
			<span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">right_limit_index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="s">&quot;Index tuple for axis must have one element!&quot;</span>
			<span class="n">right_limit_index</span> <span class="o">=</span> <span class="n">right_limit_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="c"># Try to address the place of the index:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="n">left_limit_index</span><span class="p">]</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="n">right_limit_index</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&quot;ERROR: ROI index not int as in indexing.&quot;</span><span class="p">)</span>
			<span class="k">raise</span> <span class="n">e</span>
		<span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&quot;ERROR: ROI index not valid (typically out of bounds).&quot;</span><span class="p">)</span>
			<span class="k">raise</span> <span class="n">e</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">keyindex</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_limit_index</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">keyindex</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_limit_index</span>
</div>
<div class="viewcode-block" id="ROI.unset_limits"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.unset_limits">[docs]</a>	<span class="k">def</span> <span class="nf">unset_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Unset both limits for one axis:</span>

<span class="sd">		:param key: A valid identifier of an axis of the DataSet (see DataSet.get_axis())</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">keyindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_axis_index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">keyindex</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="ROI.set_limit_left"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.set_limit_left">[docs]</a>	<span class="k">def</span> <span class="nf">set_limit_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">by_index</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Sets the left limit for one axis.</span>

<span class="sd">		:param key: A valid identifier of an axis of the DataSet (see DataSet.get_axis())</span>

<span class="sd">		:param value: The new value for the left limit.</span>

<span class="sd">		:param by_index: Bool flag to interpret limits not as positions, but as array indices.</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">keyindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_axis_index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">keyindex</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">by_index</span><span class="p">:</span>
			<span class="n">left_limit_index</span> <span class="o">=</span> <span class="n">value</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">left_limit_index</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_nearest_index</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
			<span class="c"># get_nearest_index returns an index tuple, which has only 1 element for the 1D axis.</span>
			<span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">left_limit_index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="s">&quot;Index tuple for axis must have one element!&quot;</span>
			<span class="n">left_limit_index</span> <span class="o">=</span> <span class="n">left_limit_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="c"># Try to address the place of the index:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="n">left_limit_index</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&quot;ERROR: ROI index not int as in indexing.&quot;</span><span class="p">)</span>
			<span class="k">raise</span> <span class="n">e</span>
		<span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&quot;ERROR: ROI index not valid (typically out of bounds).&quot;</span><span class="p">)</span>
			<span class="k">raise</span> <span class="n">e</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">keyindex</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_limit_index</span>
</div>
<div class="viewcode-block" id="ROI.unset_limit_left"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.unset_limit_left">[docs]</a>	<span class="k">def</span> <span class="nf">unset_limit_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Unset left limit for one axis.</span>

<span class="sd">		:param key: A valid identifier of an axis of the DataSet (see DataSet.get_axis())</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">keyindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_axis_index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">keyindex</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="ROI.set_limit_right"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.set_limit_right">[docs]</a>	<span class="k">def</span> <span class="nf">set_limit_right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">by_index</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Sets the right limit for one axis:</span>

<span class="sd">		:param key: A valid identifier of an axis of the DataSet (see DataSet.get_axis())</span>

<span class="sd">		:param value: Tuple or list of length 2 with the new values for the limits.</span>

<span class="sd">		:param by_index: Bool flag to interpret limits not as positions, but as array indices.</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">keyindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_axis_index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">keyindex</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">by_index</span><span class="p">:</span>
			<span class="n">right_limit_index</span> <span class="o">=</span> <span class="n">value</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">right_limit_index</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_nearest_index</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
			<span class="c"># get_nearest_index returns an index tuple, which has only 1 element for the 1D axis.</span>
			<span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">right_limit_index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="s">&quot;Index tuple for axis must have one element!&quot;</span>
			<span class="n">right_limit_index</span> <span class="o">=</span> <span class="n">right_limit_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="n">right_limit_index</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&quot;ERROR: ROI index not int as in indexing.&quot;</span><span class="p">)</span>
			<span class="k">raise</span> <span class="n">e</span>
		<span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&quot;ERROR: ROI index not valid (typically out of bounds).&quot;</span><span class="p">)</span>
			<span class="k">raise</span> <span class="n">e</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">keyindex</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_limit_index</span>
</div>
<div class="viewcode-block" id="ROI.unset_limit_right"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.unset_limit_right">[docs]</a>	<span class="k">def</span> <span class="nf">unset_limit_right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Unset right limit for one axis.</span>

<span class="sd">		:param key: A valid identifier of an axis of the DataSet (see DataSet.get_axis())</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">keyindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_axis_index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">keyindex</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="ROI.get_slice"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.get_slice">[docs]</a>	<span class="k">def</span> <span class="nf">get_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_key</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Creates a slice object (or tuple of them) out of the limits of the ROI This can be used directly in the [] for</span>
<span class="sd">		adressing the part of the arrays corresponding to the ROI.</span>
<span class="sd">		See:</span>
<span class="sd">		http://docs.scipy.org/doc/numpy-1.10.0/reference/generated/numpy.s_.html</span>
<span class="sd">		https://docs.python.org/2/c-api/slice.html</span>

<span class="sd">		:param data_key: A valid identifier of an axis or datafield of the DataSet (see DataSet.get_axis()) If given,</span>
<span class="sd">			return a slice applicable to an axis of the dataset instead of the whole data array. If the identifier</span>
<span class="sd">			corresponds to a datafield, the whole slice as with None will be returned.</span>

<span class="sd">		:return: The create slice object.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data_key</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">data_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabels</span><span class="p">):</span>
			<span class="c"># Generate slice tuple for all axes:</span>
			<span class="n">slicelist</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">)):</span>
				<span class="n">slicelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>  <span class="c"># recursive call for single axis slice element.</span>
			<span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">slicelist</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c"># Generate slice for single axis:</span>
			<span class="n">axis_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axis_index</span><span class="p">(</span><span class="n">data_key</span><span class="p">)</span>
			<span class="n">llim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">axis_index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">rlim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">axis_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">rlim</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># there is no right limit, so the left limit is llim, which can be a number or None:</span>
				<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">s_</span><span class="p">[</span><span class="n">llim</span><span class="p">:</span><span class="bp">None</span><span class="p">]</span>
			<span class="k">elif</span> <span class="n">llim</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># if there is a right but no left limit, the slice index (works excluding) is rlim+1:</span>
				<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">s_</span><span class="p">[</span><span class="bp">None</span><span class="p">:</span><span class="n">rlim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
			<span class="k">elif</span> <span class="n">llim</span> <span class="o">&lt;=</span> <span class="n">rlim</span><span class="p">:</span>  <span class="c"># both limits given, standard order:</span>
				<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">s_</span><span class="p">[</span><span class="n">llim</span><span class="p">:</span><span class="n">rlim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>  <span class="c"># both limits given, reverse order:</span>
				<span class="k">if</span> <span class="n">rlim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># 0 as index is only adressable like follows, b/c excluding:</span>
					<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">s_</span><span class="p">[</span><span class="n">llim</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>  <span class="c"># rlim must be shifted like above, b/c excluding:</span>
					<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">s_</span><span class="p">[</span><span class="n">llim</span><span class="p">:</span><span class="n">rlim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="ROI.get_limits"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.get_limits">[docs]</a>	<span class="k">def</span> <span class="nf">get_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_key</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">by_index</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns the limits that define the ROI. Normally, the physical positions of the limits are given,</span>
<span class="sd">		see by_index. The limits of the axes are given as lists of length 2 (2-lists).</span>

<span class="sd">		:param data_key: A valid identifier of an axis or datafield of the DataSet (see DataSet.get_axis()) If given,</span>
<span class="sd">			return the limits of an axis of the dataset instead of the whole data array. If the identifier</span>
<span class="sd">			corresponds to a datafield, the whole limit list as with None will be returned.</span>

<span class="sd">		:param by_index: Boolean flag: If True, return the limit axis indices instead of physical positions on the</span>
<span class="sd">			axis.</span>

<span class="sd">		:param raw: Boolean flag: If True, return floats instead of quantities.</span>

<span class="sd">		:return: A 2-list or list of 2-lists as specified before.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data_key</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">data_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabels</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">by_index</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">limlist</span> <span class="o">=</span> <span class="p">[]</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">)):</span>
					<span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axis</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
					<span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
						<span class="n">limlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">])</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">limlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
				<span class="k">return</span> <span class="n">limlist</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">ax_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axis_index</span><span class="p">(</span><span class="n">data_key</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">by_index</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="n">ax_index</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axis</span><span class="p">(</span><span class="n">data_key</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
					<span class="k">return</span> <span class="p">[</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">return</span> <span class="p">[</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</div>
<div class="viewcode-block" id="ROI.get_datafield"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.get_datafield">[docs]</a>	<span class="k">def</span> <span class="nf">get_datafield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_or_index</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Tries to assign a DataField to a given parameter, that can be an integer as an index in the</span>
<span class="sd">		datafields list or a label string. Raises exceptions if there is no matching field.</span>
<span class="sd">		Uses the underlying method of the DataSet.</span>

<span class="sd">		:param label_or_index: Identifier of the DataField</span>

<span class="sd">		:return: The corresponding DataField.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_datafield</span><span class="p">(</span><span class="n">label_or_index</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_slice</span><span class="p">()]</span>
</div>
<div class="viewcode-block" id="ROI.get_datafield_index"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.get_datafield_index">[docs]</a>	<span class="k">def</span> <span class="nf">get_datafield_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_or_index</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_datafield_index</span><span class="p">(</span><span class="n">label_or_index</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ROI.get_datafield_normalized"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.get_datafield_normalized">[docs]</a>	<span class="k">def</span> <span class="nf">get_datafield_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_or_index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&quot;maximum&quot;</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Like get_datafield, but returns a normalized DataArray.</span>

<span class="sd">		:param label_or_index: Identifier of the DataField</span>

<span class="sd">		:param method: Method to normalize with: Valid options:</span>
<span class="sd">			* &quot;maximum&quot;, &quot;max&quot; (default): divide every value by the maximum value in the set</span>
<span class="sd">			* &quot;mean&quot;: divide every value by the average value in the set</span>
<span class="sd">			* &quot;minimum&quot;, &quot;min&quot;: divide every value by the minimum value in the set</span>
<span class="sd">			* &quot;absolute maximum&quot;, &quot;absmax&quot;: divide every value by the maximum absolute value in the set</span>
<span class="sd">			* &quot;absolute minimum&quot;, &quot;absmin&quot;: divide every value by the minimum absolute value in the set</span>

<span class="sd">		:return: The normalized DataArray instance.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_datafield</span><span class="p">(</span><span class="n">label_or_index</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;maximum&quot;</span><span class="p">,</span> <span class="s">&quot;max&quot;</span><span class="p">]:</span>
			<span class="k">return</span> <span class="n">ds</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;minimum&quot;</span><span class="p">,</span> <span class="s">&quot;min&quot;</span><span class="p">]:</span>
			<span class="k">return</span> <span class="n">ds</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;mean&quot;</span><span class="p">]:</span>
			<span class="k">return</span> <span class="n">ds</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;absolute maximum&quot;</span><span class="p">,</span> <span class="s">&quot;max&quot;</span><span class="p">]:</span>
			<span class="k">return</span> <span class="n">ds</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">absmax</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;absolute minimum&quot;</span><span class="p">,</span> <span class="s">&quot;min&quot;</span><span class="p">]:</span>
			<span class="k">return</span> <span class="n">ds</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">absmin</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;WARNING: Normalization method not valid. Returning unnormalized data.&quot;</span>
			<span class="k">return</span> <span class="n">ds</span>
		<span class="c"># TODO: Testing of this method.</span>
</div>
<div class="viewcode-block" id="ROI.get_datafield_by_dimension"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.get_datafield_by_dimension">[docs]</a>	<span class="k">def</span> <span class="nf">get_datafield_by_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns the first datafield that corresponds to a given unit in its physical dimensionality.</span>

<span class="sd">		:param unit: Quantity or anything that can be cast as quantity by the UnitRegistry.</span>

<span class="sd">		:return: the datafield</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_datafield_by_dimension</span><span class="p">(</span><span class="n">unit</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_slice</span><span class="p">()]</span>
</div>
<div class="viewcode-block" id="ROI.get_axis"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.get_axis">[docs]</a>	<span class="k">def</span> <span class="nf">get_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_or_index</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Tries to assign an Axis to a given parameter, that can be an integer as an index in the</span>
<span class="sd">		axes list or a label string. Raises exceptions if there is no matching element.</span>
<span class="sd">		Uses the underlying method of the DataSet.</span>

<span class="sd">		:param label_or_index: Identifier of the Axis.</span>

<span class="sd">		:return: The corresponding Axis.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_axis</span><span class="p">(</span><span class="n">label_or_index</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="n">label_or_index</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="ROI.get_axis_index"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.get_axis_index">[docs]</a>	<span class="k">def</span> <span class="nf">get_axis_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_or_index</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_axis_index</span><span class="p">(</span><span class="n">label_or_index</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ROI.get_axis_by_dimension"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.get_axis_by_dimension">[docs]</a>	<span class="k">def</span> <span class="nf">get_axis_by_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns the first axis that corresponds to a given unit in its physical dimensionality.</span>

<span class="sd">		:param unit: Quantity or anything that can be cast as quantity by the UnitRegistry.</span>

<span class="sd">		:return: the Axis</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_axis_by_dimension</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ax</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">label</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="ROI.meshgrid"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.meshgrid">[docs]</a>	<span class="k">def</span> <span class="nf">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		This function returns coordinate arrays corresponding to the axes. See numpy.meshgrid. If axes are not</span>
<span class="sd">		constricted by axes argument, the output arrays will have the same shape as the data arrays of the dataset.</span>
<span class="sd">		Uses snomtools.calcs.units.meshgrid() under the hood to preserve units.</span>

<span class="sd">		:param axes: optional: a list of axes identifiers to be included. If none is given, all axes are included.</span>

<span class="sd">		:return: A tuple of coordinate arrays.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
			<span class="c"># Assemble axes:</span>
			<span class="n">list_of_axes</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
				<span class="n">list_of_axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_axis</span><span class="p">(</span><span class="n">identifier</span><span class="p">))</span>
			<span class="c"># Build grid:</span>
			<span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_axes</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c"># Assemble axes:</span>
			<span class="n">list_of_axes</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">axes</span><span class="p">)):</span>
				<span class="n">list_of_axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_axis</span><span class="p">(</span><span class="n">identifier</span><span class="p">))</span>
			<span class="c"># Build grid:</span>
			<span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_axes</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ROI.project_nd"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.ROI.project_nd">[docs]</a>	<span class="k">def</span> <span class="nf">project_nd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Projects the ROI onto the given axes. Uses the DataSet.project_nd() method for every datset and returns a</span>
<span class="sd">		new ROI with the projected DataFields and the chosen axes.</span>

<span class="sd">		:param args: Valid identifiers for the axes to project onto.</span>

<span class="sd">		:return: DataSet: Projected DataSet.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="s">&#39;h5target&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
			<span class="n">h5target</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;h5target&#39;</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">h5target</span><span class="o">=</span><span class="bp">None</span>
		<span class="n">indexlist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">get_axis_index</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
		<span class="n">newdataset</span> <span class="o">=</span> <span class="n">DataSet</span><span class="p">(</span><span class="n">datafields</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">project_nd</span><span class="p">(</span><span class="o">*</span><span class="n">indexlist</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indexlist</span><span class="p">],</span>
							 <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indexlist</span><span class="p">],</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">newdataset</span><span class="p">,</span>
							  <span class="n">limitlist</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_limits</span><span class="p">(</span><span class="n">by_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indexlist</span><span class="p">],</span>
							  <span class="n">by_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="DataSet"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet">[docs]</a><span class="k">class</span> <span class="nc">DataSet</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	A data set is a collection of data arrays combined to have a physical meaning. These are n-dimensional</span>
<span class="sd">	sets of physical values, in which every dimension itself has a physical meaning. This might for example be a</span>
<span class="sd">	3D-array of count rates, in which the x- y- and z-dimensions represent the position on a sample (x,</span>
<span class="sd">	y in micrometers) and a time delay (z = t in femtoseconds).</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c"># FIXME: check for unique axis and datafield identifiers.</span>

<div class="viewcode-block" id="DataSet.__init__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.__init__">[docs]</a>	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">datafields</span><span class="o">=</span><span class="p">(),</span> <span class="n">axes</span><span class="o">=</span><span class="p">(),</span> <span class="n">plotconf</span><span class="o">=</span><span class="p">(),</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">chunk_cache_mem_size</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5target</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="o">=</span> <span class="n">h5target</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">own_h5file</span> <span class="o">=</span> <span class="bp">False</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">datafieldgrp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="o">.</span><span class="n">require_group</span><span class="p">(</span><span class="s">&quot;datafields&quot;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">axesgrp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="o">.</span><span class="n">require_group</span><span class="p">(</span><span class="s">&quot;axes&quot;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5target</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="o">=</span> <span class="n">h5tools</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">h5target</span><span class="p">,</span> <span class="n">chunk_cache_mem_size</span><span class="o">=</span><span class="n">chunk_cache_mem_size</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">own_h5file</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">datafieldgrp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="o">.</span><span class="n">require_group</span><span class="p">(</span><span class="s">&quot;datafields&quot;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">axesgrp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="o">.</span><span class="n">require_group</span><span class="p">(</span><span class="s">&quot;axes&quot;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">h5target</span><span class="p">:</span>  <span class="c"># True but no designated target means temp file mode.</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">own_h5file</span> <span class="o">=</span> <span class="bp">False</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">datafieldgrp</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">axesgrp</span> <span class="o">=</span> <span class="bp">True</span>
		<span class="k">else</span><span class="p">:</span>  <span class="c"># Numpy mode.</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">own_h5file</span> <span class="o">=</span> <span class="bp">False</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">datafieldgrp</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">axesgrp</span> <span class="o">=</span> <span class="bp">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
		<span class="c"># check data format and convert it do correct DataArray and Axis objects before assigning it to members:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">datafields</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">datafields</span><span class="p">:</span>  <span class="c"># Fill datafield list with correctly formatted datafield objects.</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>  <span class="c"># Temp h5 mode</span>
				<span class="n">moep</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">:</span>  <span class="c"># Proper h5 file mode</span>
				<span class="n">moep</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
				<span class="n">grp</span> <span class="o">=</span> <span class="n">moep</span><span class="o">.</span><span class="n">store_to_h5</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datafieldgrp</span><span class="p">)</span>
				<span class="n">moep</span> <span class="o">=</span> <span class="n">DataArray</span><span class="o">.</span><span class="n">in_h5</span><span class="p">(</span><span class="n">grp</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>  <span class="c"># Numpy mode</span>
				<span class="n">moep</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">moep</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>  <span class="c"># Fill axes list with correctly formatted axes objects.</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>  <span class="c"># Temp h5 mode</span>
				<span class="n">moep</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">:</span>  <span class="c"># Proper h5 file mode</span>
				<span class="n">moep</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
				<span class="n">grp</span> <span class="o">=</span> <span class="n">moep</span><span class="o">.</span><span class="n">store_to_h5</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axesgrp</span><span class="p">)</span>
				<span class="n">moep</span> <span class="o">=</span> <span class="n">Axis</span><span class="o">.</span><span class="n">in_h5</span><span class="p">(</span><span class="n">grp</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>  <span class="c"># Numpy mode</span>
				<span class="n">moep</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">moep</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">check_data_consistency</span><span class="p">()</span>

		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">plotconf</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">plotconf</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">plotconf</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">plotconf</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">plotconf</span><span class="p">)</span>
</div>
	<span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataSet.from_h5file"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.from_h5file">[docs]</a>	<span class="k">def</span> <span class="nf">from_h5file</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">chunk_cache_mem_size</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Initializes a new DataSet from an existing HDF5 file. The file must be structured in accordance to the</span>
<span class="sd">		saveh5() and loadh5() methods in this class. Uses loadh5 under the hood!</span>
<span class="sd">		This method is kept for backwards compatibility, while newer from_h5 method expands its function.</span>

<span class="sd">		:param path: The (absolute or relative) path of the HDF5 file to read.</span>

<span class="sd">		:return: The initialized DataSet</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">from_h5</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>
</div>
	<span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataSet.from_h5"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.from_h5">[docs]</a>	<span class="k">def</span> <span class="nf">from_h5</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">h5source</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">chunk_cache_mem_size</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Initializes a new DataSet from an existing HDF5 source. The file must be structured in accordance to the</span>
<span class="sd">		saveh5() and loadh5() methods in this class. Uses loadh5 under the hood!</span>

<span class="sd">		:param h5source: The (absolute or relative) path of the HDF5 file to read, or an existing h5py Group/File of</span>
<span class="sd">			the base of	the Dataset.</span>

<span class="sd">		:return: The initialized DataSet</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">dataset</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">h5source</span><span class="p">),</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5source</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
			<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">h5source</span><span class="p">)</span>
			<span class="n">h5source</span> <span class="o">=</span> <span class="n">h5tools</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">chunk_cache_mem_size</span><span class="o">=</span><span class="n">chunk_cache_mem_size</span><span class="p">)</span>
		<span class="c"># Load data:</span>
		<span class="n">dataset</span><span class="o">.</span><span class="n">loadh5</span><span class="p">(</span><span class="n">h5source</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">dataset</span>
</div>
	<span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataSet.in_h5"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.in_h5">[docs]</a>	<span class="k">def</span> <span class="nf">in_h5</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">h5group</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Opens a DataSet from a h5 source, which then works on the source (in-place). This is forwards to</span>
<span class="sd">		 from_h5(h5group, h5group).</span>

<span class="sd">		:param h5group: The (absolute or relative) path of the HDF5 file to read, or an existing h5py Group/File of</span>
<span class="sd">			the base of the Dataset.</span>

<span class="sd">		:return: The generated instance.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">from_h5</span><span class="p">(</span><span class="n">h5group</span><span class="p">,</span> <span class="n">h5group</span><span class="p">)</span>
</div>
	<span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataSet.from_textfile"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.from_textfile">[docs]</a>	<span class="k">def</span> <span class="nf">from_textfile</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Initializes a new DataSet from an existing text file. The file must contain the data in a column structure</span>
<span class="sd">		and can contain additional metadata in comment lines.</span>
<span class="sd">		Uses load_textfile() under the hood! See doc of this method for more details!</span>

<span class="sd">		:param path: The (absolute or relative) path of the text file to read.</span>

<span class="sd">		:param kwargs: Keyword arguments for load_textfile and the underlying numpy.loadtxt(). See there</span>
<span class="sd">			documentation for specifics,</span>

<span class="sd">		:return: The initialized DataSet</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="c"># Initalize empty DataSet with the filename as label:</span>
		<span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="n">dataset</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>
		<span class="c"># Load data:</span>
		<span class="n">dataset</span><span class="o">.</span><span class="n">load_textfile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">dataset</span>

	<span class="c"># TODO: Property all the things in __getattr__!</span></div>
<div class="viewcode-block" id="DataSet.__getattr__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.__getattr__">[docs]</a>	<span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		This method provides dynamical naming in instances. It is called any time an attribute of the intstance is</span>
<span class="sd">		not found with the normal naming mechanism. Raises an AttributeError if the name cannot be resolved.</span>

<span class="sd">		:param item: The name to get the corresponding attribute.</span>

<span class="sd">		:return: The attribute corresponding to the given name.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s">&quot;alldata&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span>
		<span class="k">elif</span> <span class="n">item</span> <span class="o">==</span> <span class="s">&quot;axlabels&quot;</span><span class="p">:</span>
			<span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
				<span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get_label</span><span class="p">())</span>
			<span class="k">return</span> <span class="n">labels</span>
		<span class="k">elif</span> <span class="n">item</span> <span class="o">==</span> <span class="s">&quot;dlabels&quot;</span><span class="p">:</span>
			<span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">:</span>
				<span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get_label</span><span class="p">())</span>
			<span class="k">return</span> <span class="n">labels</span>
		<span class="k">elif</span> <span class="n">item</span> <span class="o">==</span> <span class="s">&quot;labels&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlabels</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">axlabels</span>
		<span class="k">elif</span> <span class="n">item</span> <span class="o">==</span> <span class="s">&quot;dimensions&quot;</span><span class="p">:</span>
			<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">item</span> <span class="o">==</span> <span class="s">&quot;shape&quot;</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="p">()</span>
		<span class="k">elif</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">darray</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alldata</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">darray</span><span class="o">.</span><span class="n">get_label</span><span class="p">():</span>
					<span class="k">return</span> <span class="n">darray</span>
		<span class="c"># TODO: address xyz.</span>
		<span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;Name </span><span class="se">\&#39;</span><span class="s">{0}</span><span class="se">\&#39;</span><span class="s"> in DataSet object cannot be resolved!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="DataSet.add_datafield"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.add_datafield">[docs]</a>	<span class="k">def</span> <span class="nf">add_datafield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Initalizes a datafield and adds it to the list. All parameters have to be given like the __init__ of DataSets</span>
<span class="sd">		expects them.</span>

<span class="sd">		:param data:</span>

<span class="sd">		:param unit:</span>

<span class="sd">		:param label:</span>

<span class="sd">		:param plotlabel:</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>  <span class="c"># Temp h5 mode</span>
			<span class="n">moep</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">:</span>  <span class="c"># Proper h5 file mode</span>
			<span class="n">moep</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
			<span class="n">grp</span> <span class="o">=</span> <span class="n">moep</span><span class="o">.</span><span class="n">store_to_h5</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datafieldgrp</span><span class="p">)</span>
			<span class="n">moep</span> <span class="o">=</span> <span class="n">DataArray</span><span class="o">.</span><span class="n">in_h5</span><span class="p">(</span><span class="n">grp</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>  <span class="c"># Numpy mode</span>
			<span class="n">moep</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">moep</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataSet.get_datafield"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.get_datafield">[docs]</a>	<span class="k">def</span> <span class="nf">get_datafield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_or_index</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Tries to assign a DataField to a given parameter, that can be an integer as an index in the</span>
<span class="sd">		datafields list or a label string. Raises exceptions if there is no matching field.</span>

<span class="sd">		:param label_or_index: Identifier of the DataField</span>

<span class="sd">		:return: The corresponding DataField.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="n">label_or_index</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">label_or_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getattr__</span><span class="p">(</span><span class="n">label_or_index</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;DataField not found.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataSet.get_datafield_index"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.get_datafield_index">[docs]</a>	<span class="k">def</span> <span class="nf">get_datafield_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_or_index</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="n">label_or_index</span><span class="p">]</span>  <span class="c"># If this works it is an int (or int-like) and addressable as it is.</span>
			<span class="k">return</span> <span class="n">label_or_index</span>
		<span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">label_or_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__getattr__</span><span class="p">(</span><span class="n">label_or_index</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;DataField not found.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataSet.get_datafield_normalized"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.get_datafield_normalized">[docs]</a>	<span class="k">def</span> <span class="nf">get_datafield_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_or_index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&quot;maximum&quot;</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Like get_datafield, but returns a normalized DataArray.</span>

<span class="sd">		:param label_or_index: Identifier of the DataField</span>

<span class="sd">		:param method: Method to normalize with: Valid options:</span>
<span class="sd">			* &quot;maximum&quot;, &quot;max&quot; (default): divide every value by the maximum value in the set</span>
<span class="sd">			* &quot;mean&quot;: divide every value by the average value in the set</span>
<span class="sd">			* &quot;minimum&quot;, &quot;min&quot;: divide every value by the minimum value in the set</span>
<span class="sd">			* &quot;absolute maximum&quot;, &quot;absmax&quot;: divide every value by the maximum absolute value in the set</span>
<span class="sd">			* &quot;absolute minimum&quot;, &quot;absmin&quot;: divide every value by the minimum absolute value in the set</span>

<span class="sd">		:return: The normalized DataArray instance.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_datafield</span><span class="p">(</span><span class="n">label_or_index</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;maximum&quot;</span><span class="p">,</span> <span class="s">&quot;max&quot;</span><span class="p">]:</span>
			<span class="k">return</span> <span class="n">ds</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;minimum&quot;</span><span class="p">,</span> <span class="s">&quot;min&quot;</span><span class="p">]:</span>
			<span class="k">return</span> <span class="n">ds</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;mean&quot;</span><span class="p">]:</span>
			<span class="k">return</span> <span class="n">ds</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;absolute maximum&quot;</span><span class="p">,</span> <span class="s">&quot;max&quot;</span><span class="p">]:</span>
			<span class="k">return</span> <span class="n">ds</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">absmax</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;absolute minimum&quot;</span><span class="p">,</span> <span class="s">&quot;min&quot;</span><span class="p">]:</span>
			<span class="k">return</span> <span class="n">ds</span> <span class="o">/</span> <span class="n">ds</span><span class="o">.</span><span class="n">absmin</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;WARNING: Normalization method not valid. Returning unnormalized data.&quot;</span>
			<span class="k">return</span> <span class="n">ds</span>
		<span class="c"># TODO: Testing of this method.</span>
</div>
<div class="viewcode-block" id="DataSet.get_datafield_by_dimension"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.get_datafield_by_dimension">[docs]</a>	<span class="k">def</span> <span class="nf">get_datafield_by_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns the first datafield that corresponds to a given unit in its physical dimensionality.</span>

<span class="sd">		:param unit: Quantity or anything that can be cast as quantity by the UnitRegistry.</span>

<span class="sd">		:return: the datafield</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">same_dimension</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">get_data</span><span class="p">(),</span> <span class="n">unit</span><span class="p">):</span>
				<span class="k">return</span> <span class="n">df</span>
		<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;No Axis with dimensionsality found.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataSet.replace_datafield"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.replace_datafield">[docs]</a>	<span class="k">def</span> <span class="nf">replace_datafield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datafield_id</span><span class="p">,</span> <span class="n">new_datafield</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Replaces a datafield of the dataset with another. For this to make sense, the new datafield must describe the</span>
<span class="sd">		same coordinates in the dataset as the old one: Obviously, the shape must therefore be the same.</span>

<span class="sd">		:param datafield_id: Identifier of the Axis to replace. Must be a valid identifier as in get_datafield_index</span>
<span class="sd">			and get_datafield.</span>

<span class="sd">		:param new_datafield: Axis: An Axis instance that shall be put in place of the old one.</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">old_datafield_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_datafield_index</span><span class="p">(</span><span class="n">datafield_id</span><span class="p">)</span>
		<span class="n">old_datafield</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_datafield</span><span class="p">(</span><span class="n">datafield_id</span><span class="p">)</span>
		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_datafield</span><span class="p">,</span> <span class="n">DataArray</span><span class="p">),</span> <span class="s">&quot;ERROR in replace_datafield: Datafield can only be replaced with &quot;</span> \
													 <span class="s">&quot;DataArray instance.&quot;</span>
		<span class="k">assert</span> <span class="p">(</span><span class="n">old_datafield</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">new_datafield</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="s">&quot;ERROR in replace_datafield: New Datafield must have &quot;</span> \
															 <span class="s">&quot;same shape as old one.&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="n">old_datafield_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_datafield</span>
</div>
<div class="viewcode-block" id="DataSet.add_axis"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.add_axis">[docs]</a>	<span class="k">def</span> <span class="nf">add_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Initalizes a datafield and adds it to the list. All parameters have to be given like the __init__ of Axis</span>
<span class="sd">		expects them.</span>

<span class="sd">		:param data:</span>

<span class="sd">		:param unit:</span>

<span class="sd">		:param label:</span>

<span class="sd">		:param plotlabel:</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>  <span class="c"># Temp h5 mode</span>
			<span class="n">moep</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">:</span>  <span class="c"># Proper h5 file mode</span>
			<span class="n">moep</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
			<span class="n">grp</span> <span class="o">=</span> <span class="n">moep</span><span class="o">.</span><span class="n">store_to_h5</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axesgrp</span><span class="p">)</span>
			<span class="n">moep</span> <span class="o">=</span> <span class="n">Axis</span><span class="o">.</span><span class="n">in_h5</span><span class="p">(</span><span class="n">grp</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>  <span class="c"># Numpy mode</span>
			<span class="n">moep</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">moep</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataSet.get_axis"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.get_axis">[docs]</a>	<span class="k">def</span> <span class="nf">get_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_or_index</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Tries to assign an Axis to a given parameter, that can be an integer as an index in the</span>
<span class="sd">		axes list or a label string. Raises exceptions if there is no matching element.</span>

<span class="sd">		:param label_or_index: Identifier of the Axis.</span>

<span class="sd">		:return: The corresponding Axis.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">label_or_index</span><span class="p">]</span>
		<span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">label_or_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getattr__</span><span class="p">(</span><span class="n">label_or_index</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;Axis not found.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataSet.get_axis_index"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.get_axis_index">[docs]</a>	<span class="k">def</span> <span class="nf">get_axis_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_or_index</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">label_or_index</span><span class="p">]</span>  <span class="c"># If this works it is an int (or int-like) and addressable as it is.</span>
			<span class="k">return</span> <span class="n">label_or_index</span>
		<span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">label_or_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__getattr__</span><span class="p">(</span><span class="n">label_or_index</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;Axis not found.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataSet.get_axis_by_dimension"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.get_axis_by_dimension">[docs]</a>	<span class="k">def</span> <span class="nf">get_axis_by_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns the first axis that corresponds to a given unit in its physical dimensionality.</span>

<span class="sd">		:param unit: Quantity or anything that can be cast as quantity by the UnitRegistry.</span>

<span class="sd">		:return: the Axis</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">same_dimension</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_data</span><span class="p">(),</span> <span class="n">unit</span><span class="p">):</span>
				<span class="k">return</span> <span class="n">ax</span>
		<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;No Axis with dimensionsality found.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataSet.replace_axis"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.replace_axis">[docs]</a>	<span class="k">def</span> <span class="nf">replace_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_id</span><span class="p">,</span> <span class="n">new_axis</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Replaces an axis of the dataset with another. For this to make sense, the new axis must describe the same</span>
<span class="sd">		coordinates in the dataset as the old one: Obviously, the shape must therefore be the same.</span>

<span class="sd">		:param axis_id: Identifier of the Axis to replace. Must be a valid identifier as in get_axis_index and get_axis.</span>

<span class="sd">		:param new_axis: Axis: An Axis instance that shall be put in place of the old one.</span>

<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">old_axis_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axis_index</span><span class="p">(</span><span class="n">axis_id</span><span class="p">)</span>
		<span class="n">old_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axis</span><span class="p">(</span><span class="n">axis_id</span><span class="p">)</span>
		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_axis</span><span class="p">,</span> <span class="n">Axis</span><span class="p">),</span> <span class="s">&quot;ERROR in replace_axis: Axis can only be replaced with Axis instance.&quot;</span>
		<span class="k">assert</span> <span class="p">(</span><span class="n">old_axis</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">new_axis</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="s">&quot;ERROR in replace_axis: New Axis must have same shape as old one.&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">old_axis_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_axis</span>
</div>
<div class="viewcode-block" id="DataSet.get_plotconf"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.get_plotconf">[docs]</a>	<span class="k">def</span> <span class="nf">get_plotconf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotconf</span>
</div>
<div class="viewcode-block" id="DataSet.get_label"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.get_label">[docs]</a>	<span class="k">def</span> <span class="nf">get_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
</div>
<div class="viewcode-block" id="DataSet.set_label"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.set_label">[docs]</a>	<span class="k">def</span> <span class="nf">set_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newlabel</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">newlabel</span>
</div>
<div class="viewcode-block" id="DataSet.meshgrid"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.meshgrid">[docs]</a>	<span class="k">def</span> <span class="nf">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		This function returns coordinate arrays corresponding to the axes. See numpy.meshgrid. If axes are not</span>
<span class="sd">		constricted by axes argument, the output arrays will have the same shape as the data arrays of the dataset.</span>
<span class="sd">		Uses snomtools.calcs.units.meshgrid() under the hood to preserve units.</span>

<span class="sd">		:param axes: optional: a list of axes identifiers to be included. If none is given, all axes are included.</span>

<span class="sd">		:return: A tuple of coordinate arrays.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
			<span class="c"># Assemble axes:</span>
			<span class="n">list_of_axes</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
				<span class="n">list_of_axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_axis</span><span class="p">(</span><span class="n">identifier</span><span class="p">))</span>
			<span class="c"># Build grid:</span>
			<span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_axes</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataSet.swapaxis"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.swapaxis">[docs]</a>	<span class="k">def</span> <span class="nf">swapaxis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis1</span><span class="p">,</span> <span class="n">axis2</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Interchanges the place of two axes.</span>

<span class="sd">		:param axis1: The first axis, addressed by its label or index.</span>

<span class="sd">		:param axis2: The second axis, addressed by its label or index.</span>

<span class="sd">		:return: Nothing.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c"># Assure numerical indices:</span>
		<span class="n">axis1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axis_index</span><span class="p">(</span><span class="n">axis1</span><span class="p">)</span>
		<span class="n">axis2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axis_index</span><span class="p">(</span><span class="n">axis2</span><span class="p">)</span>

		<span class="c"># Swap data axes and order of axes list:</span>
		<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">:</span>
			<span class="n">field</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">axis1</span><span class="p">,</span> <span class="n">axis2</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">axis2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">axis1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">axis1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">axis2</span><span class="p">]</span>

		<span class="c"># Assure we did nothing wrong:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">check_data_consistency</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DataSet.project_nd"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.project_nd">[docs]</a>	<span class="k">def</span> <span class="nf">project_nd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Projects the datafield onto the given axes. Uses the DataSet.project_nd() method for every datset and returns a</span>
<span class="sd">		new DataSet with the projected DataFields and the chosen axes.</span>

<span class="sd">		:param args: Valid identifiers for the axes to project onto.</span>

<span class="sd">		:return: DataSet: Projected DataSet.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="s">&#39;h5target&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
			<span class="n">h5target</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;h5target&#39;</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">h5target</span><span class="o">=</span><span class="bp">None</span>
		<span class="n">indexlist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">get_axis_index</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span>
			<span class="n">datafields</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">project_nd</span><span class="p">(</span><span class="o">*</span><span class="n">indexlist</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">))],</span>
			<span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indexlist</span><span class="p">],</span>
			<span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataSet.bin"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.bin">[docs]</a>	<span class="k">def</span> <span class="nf">bin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="p">()):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		To be implemented (imported from Ben&#39;s script)</span>
<span class="sd">		:param bin_size:</span>
<span class="sd">		:return:</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DataSet.check_data_consistency"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.check_data_consistency">[docs]</a>	<span class="k">def</span> <span class="nf">check_data_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Self test method which checks the dimensionality and shapes of the axes and datafields. Raises</span>
<span class="sd">		AssertionError if one of the tests fails.</span>

<span class="sd">		:return: True if the test is successful.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">:</span>  <span class="c"># Check if all datafields have the same shape.</span>
			<span class="k">assert</span> <span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="s">&quot;Dataset datafields with different shapes.&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">:</span>  <span class="c"># If we have data at all...</span>
			<span class="c"># Check if we have the same number of axes as the number of datafield dimensions:</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">),</span> <span class="s">&quot;Number of axes don&#39;t fit to data dimensionality.&quot;</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)):</span>  <span class="c"># Check if axes have the same lengths as the corresponding datafield dimension.</span>
			<span class="c"># print &quot;Axis &quot;+str(i)+&quot;:&quot;</span>
			<span class="c"># print(&quot;axis len: &quot;+str(len(self.axes[i])))</span>
			<span class="c"># print(&quot;data len: &quot;+str(self.datafields[0].shape[i]))</span>
			<span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="s">&quot;Axes lenghts don&#39;t fit to data dimensions.&quot;</span>
		<span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="DataSet.check_label_uniqueness"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.check_label_uniqueness">[docs]</a>	<span class="k">def</span> <span class="nf">check_label_uniqueness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Checks if the labels of the DataSets datafields and axes are unique. This is important to call them directly</span>
<span class="sd">		by their labels.</span>

<span class="sd">		:param newlabel: If given, this method checks the viability of a new label to add to the DataSet.</span>

<span class="sd">		:return: True if test is successful.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">newlabel</span><span class="p">:</span>  <span class="c"># we check if a new label would be viable:</span>
			<span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">newlabel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>  <span class="c"># selfcheck without newlabel:</span>
			<span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">))),</span> <span class="s">&quot;DataSet data array and axes labels not unique.&quot;</span>
			<span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="DataSet.saveh5"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.saveh5">[docs]</a>	<span class="k">def</span> <span class="nf">saveh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5dest</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Saves the Dataset to a HDF5 destination in a unified format.</span>

<span class="sd">		:param h5dest: String or h5py Group/File: The destination to write to.</span>
<span class="sd">		 </span>
<span class="sd">		:return: Nothing.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">h5dest</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">h5dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5dest</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
			<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">h5dest</span><span class="p">)</span>
			<span class="n">h5dest</span> <span class="o">=</span> <span class="n">h5tools</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">path</span> <span class="o">=</span> <span class="bp">False</span>
		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5dest</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">),</span> <span class="s">&quot;DataSet.saveh5 needs h5 group or destination path as argument!&quot;</span>

		<span class="c"># TODO: Store snomtools version that data was saved with!</span>
		<span class="n">datafieldgrp</span> <span class="o">=</span> <span class="n">h5dest</span><span class="o">.</span><span class="n">require_group</span><span class="p">(</span><span class="s">&quot;datafields&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">)):</span>
			<span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">store_to_h5</span><span class="p">(</span><span class="n">datafieldgrp</span><span class="p">)</span>
			<span class="n">h5tools</span><span class="o">.</span><span class="n">write_dataset</span><span class="p">(</span><span class="n">grp</span><span class="p">,</span> <span class="s">&quot;index&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
		<span class="n">axesgrp</span> <span class="o">=</span> <span class="n">h5dest</span><span class="o">.</span><span class="n">require_group</span><span class="p">(</span><span class="s">&quot;axes&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)):</span>
			<span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">store_to_h5</span><span class="p">(</span><span class="n">axesgrp</span><span class="p">)</span>
			<span class="n">h5tools</span><span class="o">.</span><span class="n">write_dataset</span><span class="p">(</span><span class="n">grp</span><span class="p">,</span> <span class="s">&quot;index&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
		<span class="n">h5tools</span><span class="o">.</span><span class="n">write_dataset</span><span class="p">(</span><span class="n">h5dest</span><span class="p">,</span> <span class="s">&quot;label&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
		<span class="n">plotconfgrp</span> <span class="o">=</span> <span class="n">h5dest</span><span class="o">.</span><span class="n">require_group</span><span class="p">(</span><span class="s">&quot;plotconf&quot;</span><span class="p">)</span>
		<span class="n">h5tools</span><span class="o">.</span><span class="n">store_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotconf</span><span class="p">,</span> <span class="n">plotconfgrp</span><span class="p">)</span>
		<span class="n">h5dest</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">path</span><span class="p">:</span>  <span class="c"># We got a path and wrote in new h5 file, so we&#39;ll close that file.</span>
			<span class="n">h5dest</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DataSet.loadh5"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.loadh5">[docs]</a>	<span class="k">def</span> <span class="nf">loadh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h5source</span><span class="p">):</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5source</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
			<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">h5source</span><span class="p">)</span>
			<span class="n">h5source</span> <span class="o">=</span> <span class="n">h5tools</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">path</span> <span class="o">=</span> <span class="bp">False</span>
		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5source</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">),</span> \
			<span class="s">&quot;DataSet.saveh5 needs h5 group or destination path as argument if no instance h5target is set.&quot;</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">h5source</span><span class="p">[</span><span class="s">&quot;label&quot;</span><span class="p">][()])</span>
		<span class="n">datafieldgrp</span> <span class="o">=</span> <span class="n">h5source</span><span class="p">[</span><span class="s">&quot;datafields&quot;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">datafields</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datafieldgrp</span><span class="p">))]</span>
		<span class="k">for</span> <span class="n">datafield</span> <span class="ow">in</span> <span class="n">datafieldgrp</span><span class="p">:</span>
			<span class="n">index</span> <span class="o">=</span> <span class="n">datafieldgrp</span><span class="p">[</span><span class="n">datafield</span><span class="p">][</span><span class="s">&#39;index&#39;</span><span class="p">][()]</span>
			<span class="k">if</span> <span class="n">h5source</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">:</span>
				<span class="n">dest</span> <span class="o">=</span> <span class="n">datafieldgrp</span><span class="p">[</span><span class="n">datafield</span><span class="p">]</span>
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
				<span class="n">dest</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">:</span>
				<span class="n">dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafieldgrp</span><span class="o">.</span><span class="n">require_group</span><span class="p">(</span><span class="n">datafield</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">dest</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">DataArray</span><span class="o">.</span><span class="n">from_h5</span><span class="p">(</span><span class="n">datafieldgrp</span><span class="p">[</span><span class="n">datafield</span><span class="p">],</span> <span class="n">h5target</span><span class="o">=</span><span class="n">dest</span><span class="p">))</span>
		<span class="n">axesgrp</span> <span class="o">=</span> <span class="n">h5source</span><span class="p">[</span><span class="s">&quot;axes&quot;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axesgrp</span><span class="p">))]</span>
		<span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">axesgrp</span><span class="p">:</span>
			<span class="n">index</span> <span class="o">=</span> <span class="n">axesgrp</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s">&#39;index&#39;</span><span class="p">][()]</span>
			<span class="k">if</span> <span class="n">h5source</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">:</span>
				<span class="n">dest</span> <span class="o">=</span> <span class="n">axesgrp</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
				<span class="n">dest</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="p">:</span>
				<span class="n">dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axesgrp</span><span class="o">.</span><span class="n">require_group</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">dest</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Axis</span><span class="o">.</span><span class="n">from_h5</span><span class="p">(</span><span class="n">axesgrp</span><span class="p">[</span><span class="n">axis</span><span class="p">],</span> <span class="n">h5target</span><span class="o">=</span><span class="n">dest</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plotconf</span> <span class="o">=</span> <span class="n">h5tools</span><span class="o">.</span><span class="n">load_dictionary</span><span class="p">(</span><span class="n">h5source</span><span class="p">[</span><span class="s">&#39;plotconf&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">check_data_consistency</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">path</span><span class="p">:</span>  <span class="c"># We got a path and read from opened h5 file, so we&#39;ll close that file.</span>
			<span class="n">h5source</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DataSet.load_textfile"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.load_textfile">[docs]</a>	<span class="k">def</span> <span class="nf">load_textfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">unitsplitter</span><span class="o">=</span><span class="s">&quot;[-\/ ]+&quot;</span><span class="p">,</span> <span class="n">labelline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
					  <span class="n">unitsline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Loads the contents of a textfile to the dataset instance. The text files are two-dimensional arrays of lines</span>
<span class="sd">		and n columns, so it can hold up to one axis and (n-1) or n DataFields. See axis parameter for information on</span>
<span class="sd">		how to set axis. Data consistency is checked at the end, so shapes of data and axis arrays must fit (as</span>
<span class="sd">		always),</span>
<span class="sd">		Uses numpy.loadtxt() under the hood!</span>
<span class="sd">		Defaults fit for gnuplot friendly files. Tries to cast the heading comment line(s) as labels and units for</span>
<span class="sd">		the data fields.</span>

<span class="sd">		:param path: The (relative or absolute) path of the text file to read.</span>

<span class="sd">		:param axis: Integer that specifies the column of the axis in the data file OR a whole axis instance of the</span>
<span class="sd">			correct shape OR None for unchanged axes of the DataSet. Default is 0 for the first column of the text file.</span>

<span class="sd">		:param comments: the character used to indicate the start of a comment line</span>

<span class="sd">		:param delimiter: character used to separate values. By default, this is any whitespace.</span>

<span class="sd">		:param unitsplitter: Regular expression to split comment columns in labels and units. Default is &quot;[-\/ ]+&quot;,</span>
<span class="sd">			which matches combinations of the chars &#39;-&#39;. &#39;/&#39; and &#39; &#39;.</span>

<span class="sd">		:param labelline: Index (starting with 0) of the comment line in which the labels are stored. (Default 0)</span>

<span class="sd">		:param unitsline: Index (starting with 0) of the comment line in which the units are stored. (Default 0) If</span>
<span class="sd">			this is different from labelline, it is assumed that ONLY the unit is in that line.</span>

<span class="sd">		:param kwargs: Keyword arguments as used for the numpy.loadtxt() method</span>

<span class="sd">		:return: Nothing</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c"># Normalize path:</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="c"># Load data from text file:</span>
		<span class="n">datacontent</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="n">comments</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
		<span class="c"># All columns contain data by default. This can change if there is an Axis:</span>
		<span class="n">datacolumns</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">datacontent</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

		<span class="c"># Handle comment lines which hold metadata like labels and units of the data columns:</span>
		<span class="n">commentsentries</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c"># The list which will hold the strings of the comment lines.</span>
		<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">datacolumns</span><span class="p">]</span>  <span class="c"># The list which will hold the label for each data column.</span>
		<span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">datacolumns</span><span class="p">]</span>  <span class="c"># The list which will hold the unit string for each data column.</span>
		<span class="n">textfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">textfile</span><span class="p">:</span>
				<span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">comments</span><span class="p">):</span>
					<span class="n">commentsentries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">comments</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">))</span>
		<span class="k">finally</span><span class="p">:</span>
			<span class="n">textfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

		<span class="c"># Check if relevant comments lines have the correct number of columns:</span>
		<span class="n">lines_not_ok</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">comments_line_i</span> <span class="ow">in</span> <span class="p">{</span><span class="n">labelline</span><span class="p">,</span> <span class="n">unitsline</span><span class="p">}:</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">commentsentries</span><span class="p">[</span><span class="n">comments_line_i</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">datacolumns</span><span class="p">):</span>
				<span class="n">lines_not_ok</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comments_line_i</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">lines_not_ok</span><span class="p">:</span>  <span class="c"># The list is not empty.</span>
			<span class="k">print</span><span class="p">(</span><span class="n">colored</span><span class="p">(</span><span class="s">&quot;WARNING: Comment line(s) {0} in textfile {1} has wrong number of columns. &quot;</span>
						  <span class="s">&quot;No metadata can be read.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lines_not_ok</span><span class="p">,</span> <span class="n">path</span><span class="p">),</span> <span class="s">&#39;yellow&#39;</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>  <span class="c"># There is a corresponding column in the comment line to each data line.</span>
			<span class="k">if</span> <span class="n">labelline</span> <span class="o">==</span> <span class="n">unitsline</span><span class="p">:</span>  <span class="c"># Labels and units in same line. We need to extract units, rest are labels:</span>
				<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">datacolumns</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">unitsplitter</span><span class="p">,</span> <span class="n">commentsentries</span><span class="p">[</span><span class="n">unitsline</span><span class="p">][</span><span class="n">column</span><span class="p">]):</span>
						<span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_valid_unit</span><span class="p">(</span><span class="n">part</span><span class="p">):</span>
							<span class="n">units</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">part</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">labels</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">+=</span> <span class="n">part</span>
			<span class="k">else</span><span class="p">:</span>  <span class="c"># Two different lines for units and labels.</span>
				<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">datacolumns</span><span class="p">:</span>
					<span class="n">unit</span> <span class="o">=</span> <span class="n">commentsentries</span><span class="p">[</span><span class="n">unitsline</span><span class="p">][</span><span class="n">column</span><span class="p">]</span>
					<span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_valid_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">):</span>
						<span class="n">units</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">unit</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">print</span><span class="p">(</span><span class="n">colored</span><span class="p">(</span><span class="s">&quot;WARNING: Invalid unit string &#39;{2}&#39; in unit line {0} in textfile {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
							<span class="n">unitsline</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">unit</span><span class="p">),</span> <span class="s">&#39;yellow&#39;</span><span class="p">))</span>
					<span class="n">labels</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">commentsentries</span><span class="p">[</span><span class="n">labelline</span><span class="p">][</span><span class="n">column</span><span class="p">]</span>

		<span class="c"># If we should handle axis:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">axis</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
			<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>  <span class="c"># Column number was given.</span>
				<span class="n">datacolumns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>  <span class="c"># Column contains axis and not data.</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Axis</span><span class="p">(</span><span class="n">datacontent</span><span class="p">[:,</span> <span class="n">axis</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">units</span><span class="p">[</span><span class="n">axis</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">axis</span><span class="p">])]</span>  <span class="c"># Initialize axis</span>
			<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">==</span> <span class="n">Axis</span><span class="p">:</span>  <span class="c"># Complete axis was given.</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axis</span><span class="p">]</span>
			<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">==</span> <span class="n">DataArray</span><span class="p">:</span>  <span class="c"># DataArray was given for axis.</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Axis</span><span class="o">.</span><span class="n">from_dataarray</span><span class="p">(</span><span class="n">axis</span><span class="p">)]</span>
			<span class="k">else</span><span class="p">:</span>  <span class="c"># We don&#39;t know what was given... Let&#39;s try to cast it as an axis.</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Axis</span><span class="p">(</span><span class="n">axis</span><span class="p">)]</span>
				<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
					<span class="k">print</span> <span class="n">colored</span><span class="p">(</span><span class="s">&quot;ERROR! Axis initialization in load_textfile failed.&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>
					<span class="k">raise</span> <span class="n">e</span>

		<span class="c"># Write the remaining data to datafields:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">datafields</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c"># Reset datafields</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">datacolumns</span><span class="p">:</span>  <span class="c"># Initialize new datafields</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">add_datafield</span><span class="p">(</span><span class="n">datacontent</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">units</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">check_label_uniqueness</span><span class="p">()</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_data_consistency</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="DataSet.__del__"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.__del__">[docs]</a>	<span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">own_h5file</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">h5target</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
	<span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataSet.stack"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.DataSet.stack">[docs]</a>	<span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">datastack</span><span class="p">,</span> <span class="n">new_axis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plotconf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Stacks a sequence of DataSets to a new DataSet.</span>
<span class="sd">		Therefore it stacks the DataArrays with stack_DataArrays() and inserts a new Axis.</span>

<span class="sd">		:param datastack: sequence of DataSets: The Data to be stacked.</span>

<span class="sd">		:param new_axis: Axis or castable as Axis: The new axis to be inserted for the dimension along which the data is</span>
<span class="sd">			stacked.</span>

<span class="sd">		:param axis: int, optional: The axis in the result array along which the input arrays are stacked.</span>

<span class="sd">		:param label: string, optional: The label for the new DataSet. If not given, the label of the first DataArray in</span>
<span class="sd">			the input stack is used.</span>

<span class="sd">		:param plotconf: The plot configuration to be used for the new DataSet. If not given, the configuration of the</span>
<span class="sd">			first DataSet in the input stack is used.</span>

<span class="sd">		:return: The stacked DataSet.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c"># Check if input data types are ok and cast defaults if necessary:</span>
		<span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">datastack</span><span class="p">:</span>
			<span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">DataSet</span><span class="p">)),</span> <span class="s">&quot;ERROR: Non-DataSet object given to stack_DataSets&quot;</span>
		<span class="n">new_axis</span> <span class="o">=</span> <span class="n">Axis</span><span class="p">(</span><span class="n">new_axis</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">label</span> <span class="o">=</span> <span class="n">datastack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">plotconf</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">plotconf</span> <span class="o">=</span> <span class="n">datastack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_plotconf</span><span class="p">()</span>

		<span class="c"># Check if data is compatible: All DataSets must have same dimensions and number of datafields:</span>
		<span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">datastack</span><span class="p">:</span>
			<span class="k">assert</span> <span class="p">(</span>
				<span class="n">ds</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">datastack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="s">&quot;ERROR: DataSets of inconsistent dimensions given to stack_DataSets&quot;</span>
			<span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">datafields</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">datastack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">datafields</span><span class="p">)),</span> <span class="s">&quot;ERROR: DataSets with different number of &quot;</span> \
																		 <span class="s">&quot;datafields given to stack_DataSets&quot;</span>

		<span class="c"># Initialize new DataSet:</span>
		<span class="n">stack</span> <span class="o">=</span> <span class="n">DataSet</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">plotconf</span><span class="o">=</span><span class="n">plotconf</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>

		<span class="c"># Build axes list by taking the axes from the first element of the stack and inserting the new one.</span>
		<span class="c"># This makes sense because for stacking to be meaningful, the axes sets of the stack need to be identical in</span>
		<span class="c"># their physical meaning.</span>
		<span class="n">axes</span> <span class="o">=</span> <span class="n">datastack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axes</span>
		<span class="c"># Case-like due to different indexing of python&#39;s builtin insert method and numpy&#39;s stack:</span>
		<span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c"># last element</span>
			<span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_axis</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">axis</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c"># n&#39;th to last element (count from back)</span>
			<span class="n">axes</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">new_axis</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>  <span class="c"># normal count from front</span>
			<span class="n">axes</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">new_axis</span><span class="p">)</span>
		<span class="n">stack</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span>

		<span class="c"># Stack the datafields all the DataSets and add them to the stacked Set:</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datastack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">datafields</span><span class="p">)):</span>
			<span class="n">dfstack</span> <span class="o">=</span> <span class="p">[</span><span class="n">ds</span><span class="o">.</span><span class="n">get_datafield</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">datastack</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">h5target</span><span class="p">:</span>
				<span class="n">stack</span><span class="o">.</span><span class="n">add_datafield</span><span class="p">(</span><span class="n">stack_DataArrays</span><span class="p">(</span><span class="n">dfstack</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">stack</span><span class="o">.</span><span class="n">add_datafield</span><span class="p">(</span><span class="n">stack_DataArrays</span><span class="p">(</span><span class="n">dfstack</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span>

		<span class="n">stack</span><span class="o">.</span><span class="n">check_data_consistency</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">stack</span>

</div></div>
<div class="viewcode-block" id="stack_DataArrays"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.stack_DataArrays">[docs]</a><span class="k">def</span> <span class="nf">stack_DataArrays</span><span class="p">(</span><span class="n">datastack</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Stacks a sequence of DataArrays to a new DataArray.</span>
<span class="sd">	See DataArray.stack.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="n">DataArray</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">datastack</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="n">plotlabel</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="stack_DataSets"><a class="viewcode-back" href="../../../source/_modules/snomtools.data.html#snomtools.data.datasets.stack_DataSets">[docs]</a><span class="k">def</span> <span class="nf">stack_DataSets</span><span class="p">(</span><span class="n">datastack</span><span class="p">,</span> <span class="n">new_axis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plotconf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Stacks a sequence of DataSets to a new DataSet.</span>
<span class="sd">	See DataSet.stack.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="n">DataSet</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">datastack</span><span class="p">,</span> <span class="n">new_axis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plotconf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5target</span><span class="p">)</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>  <span class="c"># just for testing</span>
	<span class="k">print</span> <span class="n">colored</span><span class="p">(</span><span class="s">&#39;Testing...&#39;</span><span class="p">,</span> <span class="s">&#39;yellow&#39;</span><span class="p">),</span>
	<span class="n">testarray</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span>
	<span class="n">testaxis</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">(</span><span class="n">testarray</span><span class="p">,</span> <span class="s">&#39;meter&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;xaxis&quot;</span><span class="p">)</span>
	<span class="n">testaxis2</span> <span class="o">=</span> <span class="n">testaxis</span> <span class="o">/</span> <span class="mf">2.</span>
	<span class="n">testaxis2</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&quot;yaxis&quot;</span><span class="p">)</span>
	<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">testaxis</span><span class="p">,</span> <span class="n">testaxis2</span><span class="p">)</span>
	<span class="c"># testaxis = DataArray(testarray[testarray&lt;5], &#39;meter&#39;)</span>
	<span class="n">testdata</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">X</span> <span class="o">+</span> <span class="n">Y</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">ureg</span><span class="p">(</span><span class="s">&#39;rad&#39;</span><span class="p">))</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">ureg</span><span class="p">(</span><span class="s">&#39;counts&#39;</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;testdaten&quot;</span><span class="p">,</span> <span class="n">plotlabel</span><span class="o">=</span><span class="s">&quot;pl&quot;</span><span class="p">)</span>
	<span class="c"># testdatastacklist = [testdata * i for i in range(3)]</span>

	<span class="n">pc</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;a&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">:</span> <span class="s">&quot;moep&quot;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;de&#39;</span><span class="p">:</span> <span class="s">&quot;eins/zwo&quot;</span><span class="p">}</span>

	<span class="n">testdataset</span> <span class="o">=</span> <span class="n">DataSet</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">testdata</span><span class="p">],</span> <span class="p">[</span><span class="n">testaxis</span><span class="p">,</span> <span class="n">testaxis2</span><span class="p">],</span> <span class="n">plotconf</span><span class="o">=</span><span class="n">pc</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="s">&#39;test.hdf5&#39;</span><span class="p">)</span>

	<span class="n">testroi</span> <span class="o">=</span> <span class="n">ROI</span><span class="p">(</span><span class="n">testdataset</span><span class="p">)</span>
	<span class="n">testroi</span><span class="o">.</span><span class="n">set_limits</span><span class="p">(</span><span class="s">&#39;xaxis&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

	<span class="n">testdataset</span><span class="o">.</span><span class="n">saveh5</span><span class="p">()</span>

	<span class="k">del</span> <span class="n">testdataset</span>

	<span class="n">testdataset2</span> <span class="o">=</span> <span class="n">DataSet</span><span class="o">.</span><span class="n">from_h5file</span><span class="p">(</span><span class="s">&#39;test.hdf5&#39;</span><span class="p">)</span>
	<span class="n">testdataset2</span><span class="o">.</span><span class="n">saveh5</span><span class="p">(</span><span class="s">&quot;exampledata.hdf5&quot;</span><span class="p">)</span>

	<span class="n">testdataset3</span> <span class="o">=</span> <span class="n">DataSet</span><span class="o">.</span><span class="n">from_textfile</span><span class="p">(</span><span class="s">&#39;test2.txt&#39;</span><span class="p">,</span> <span class="n">unitsline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="s">&quot;test3.hdf5&quot;</span><span class="p">)</span>
	<span class="n">testdataset3</span><span class="o">.</span><span class="n">saveh5</span><span class="p">()</span>

	<span class="n">testh5</span> <span class="o">=</span> <span class="n">h5tools</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s">&#39;test.hdf5&#39;</span><span class="p">)</span>

	<span class="n">test_dataarray</span> <span class="o">=</span> <span class="bp">True</span>
	<span class="c"># noinspection PyPackageRequirements</span>
	<span class="k">if</span> <span class="n">test_dataarray</span><span class="p">:</span>
		<span class="n">moep</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">(</span><span class="n">testaxis</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;test&quot;</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">testh5</span><span class="p">)</span>
		<span class="n">moep2</span> <span class="o">=</span> <span class="n">moep</span> <span class="o">+</span> <span class="n">moep</span>
		<span class="n">moep2</span> <span class="o">=</span> <span class="n">moep</span> <span class="o">-</span> <span class="n">moep</span>
		<span class="n">moep2</span> <span class="o">=</span> <span class="n">moep</span> <span class="o">*</span> <span class="n">moep</span>
		<span class="n">moep2</span> <span class="o">=</span> <span class="n">moep</span> <span class="o">/</span> <span class="n">moep</span>
		<span class="c"># moep2 = moep // moep # FIXME: to_ureg(DataArray) for newer versions of pint.</span>
		<span class="n">moep2</span> <span class="o">=</span> <span class="n">moep</span> <span class="o">**</span> <span class="mf">2.</span>
		<span class="n">moep</span><span class="o">.</span><span class="n">absmax</span><span class="p">()</span>
		<span class="n">moep</span><span class="o">.</span><span class="n">absmin</span><span class="p">()</span>
		<span class="n">moep</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
		<span class="n">moep</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
		<span class="n">moep</span><span class="o">.</span><span class="n">sum_raw</span><span class="p">()</span>
		<span class="c"># works till here</span>
		<span class="n">moep</span><span class="o">.</span><span class="n">get_nearest_value</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span>
		<span class="n">moep</span><span class="o">.</span><span class="n">set_unit</span><span class="p">(</span><span class="s">&#39;mm&#39;</span><span class="p">)</span>
		<span class="k">del</span> <span class="n">moep</span>

		<span class="n">bigfuckindata</span> <span class="o">=</span> <span class="n">Data_Handler_H5</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s">&#39;km&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
		<span class="n">moep</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">(</span><span class="n">bigfuckindata</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;test&quot;</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">testh5</span><span class="p">)</span>

		<span class="c"># testdataset.saveh5(&#39;test.hdf5&#39;)</span>
		<span class="n">moep</span><span class="o">.</span><span class="n">write_to_h5</span><span class="p">()</span>
		<span class="k">del</span> <span class="n">moep</span>
		<span class="n">testh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

		<span class="n">testh5</span> <span class="o">=</span> <span class="n">h5tools</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s">&#39;test.hdf5&#39;</span><span class="p">)</span>
		<span class="n">moep3</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">(</span><span class="n">testh5</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="n">testh5</span><span class="p">)</span>

		<span class="n">dhs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Data_Handler_H5</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="s">&#39;meter&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
		<span class="n">dhs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">to_ureg</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="s">&#39;millimeter&#39;</span><span class="p">))</span>
		<span class="n">stacktest</span> <span class="o">=</span> <span class="n">DataArray</span><span class="p">(</span><span class="n">Data_Handler_np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">dhs</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;millimeter&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

		<span class="n">dhs</span> <span class="o">=</span> <span class="p">[</span><span class="n">stacktest</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
		<span class="n">stacktest</span> <span class="o">=</span> <span class="n">DataArray</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">dhs</span><span class="p">,</span> <span class="n">h5target</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		<span class="c"># stackh5 = h5tools.File(&quot;stacktest.hdf5&quot;)</span>
		<span class="c"># stacktest.store_to_h5(stackh5)</span>
		<span class="c"># stackh5.close()</span>
		<span class="k">del</span> <span class="n">stacktest</span>

	<span class="n">test_sum</span> <span class="o">=</span> <span class="bp">True</span>
	<span class="k">if</span> <span class="n">test_sum</span><span class="p">:</span>
		<span class="n">h5</span> <span class="o">=</span> <span class="n">h5tools</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s">&quot;test4.hdf5&quot;</span><span class="p">)</span>
		<span class="n">mediumfuckindata</span> <span class="o">=</span> <span class="n">Data_Handler_H5</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">20</span><span class="p">)),</span> <span class="n">unit</span><span class="o">=</span><span class="s">&quot;m/s&quot;</span><span class="p">)</span>
		<span class="n">sum1</span> <span class="o">=</span> <span class="n">mediumfuckindata</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">sum2</span> <span class="o">=</span> <span class="n">mediumfuckindata</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		<span class="n">sum3</span> <span class="o">=</span> <span class="n">sum1</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">sum4</span> <span class="o">=</span> <span class="n">sum2</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		<span class="n">sum5</span> <span class="o">=</span> <span class="n">mediumfuckindata</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
		<span class="n">sum6</span> <span class="o">=</span> <span class="n">mediumfuckindata</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		<span class="n">sum7</span> <span class="o">=</span> <span class="n">mediumfuckindata</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">h5target</span><span class="o">=</span><span class="n">h5</span><span class="p">)</span>
		<span class="n">sum8</span> <span class="o">=</span> <span class="n">mediumfuckindata</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

	<span class="n">test_manyfiles</span> <span class="o">=</span> <span class="bp">False</span>
	<span class="k">if</span> <span class="n">test_manyfiles</span><span class="p">:</span>
		<span class="n">h5files</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
			<span class="n">h5files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h5tools</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s">&quot;ZZZZ{0:04d}.hdf5&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>

		<span class="k">print</span> <span class="s">&quot;writing data...&quot;</span>
		<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">h5files</span><span class="p">:</span>
			<span class="n">h5tools</span><span class="o">.</span><span class="n">write_dataset</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">20</span><span class="p">)),</span>
								  <span class="n">chunks</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
								  <span class="n">compression</span><span class="o">=</span><span class="s">&quot;gzip&quot;</span><span class="p">,</span>
								  <span class="n">compression_opts</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

		<span class="k">print</span> <span class="s">&quot;closing...&quot;</span>
		<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">h5files</span><span class="p">:</span>
			<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="n">cprint</span><span class="p">(</span><span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="s">&#39;green&#39;</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">snomtools 0.0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, AG Aeschlimann, FB Physik, TU Kaiserslautern.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>